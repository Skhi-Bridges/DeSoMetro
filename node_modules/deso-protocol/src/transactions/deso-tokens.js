import { hexToBytes } from '@noble/hashes/utils';
import { TransactionMetadataDAOCoin, TransactionMetadataTransferDAOCoin, bs58PublicKeyToCompressedBytes, } from '../identity/index.js';
import { constructBalanceModelTx, handleSignAndSubmit, isMaybeDeSoPublicKey, } from '../internal.js';
export const burnDeSoToken = (params, options) => {
    return handleSignAndSubmit('api/v0/dao-coin', {
        ...params,
        OperationType: 'burn',
    }, { ...options, constructionFunction: constructBurnDeSoTokenTransaction });
};
export const constructBurnDeSoTokenTransaction = (params) => {
    const metadata = new TransactionMetadataDAOCoin();
    // TODO: I know we're passing hex strings representing uint256, but need
    // to figure out how they go to bytes.
    if (!isMaybeDeSoPublicKey(params.ProfilePublicKeyBase58CheckOrUsername)) {
        return Promise.reject('must provide profile public key, not username for local transaction construction');
    }
    metadata.coinsToBurnNanos = hexToBytes(params.CoinsToBurnNanos.replace('0x', 'x'));
    metadata.profilePublicKey = bs58PublicKeyToCompressedBytes(params.ProfilePublicKeyBase58CheckOrUsername);
    metadata.operationType = 1;
    return constructBalanceModelTx(params.UpdaterPublicKeyBase58Check, metadata, {
        ExtraData: params.ExtraData,
        MinFeeRateNanosPerKB: params.MinFeeRateNanosPerKB,
        TransactionFees: params.TransactionFees,
    });
};
export const mintDeSoToken = (params, options) => {
    return handleSignAndSubmit('api/v0/dao-coin', {
        ...params,
        OperationType: 'mint',
    }, { ...options, constructionFunction: constructMintDeSoTokenTransaction });
};
export const constructMintDeSoTokenTransaction = (params) => {
    const metadata = new TransactionMetadataDAOCoin();
    // TODO: I know we're passing hex strings representing uint256, but need
    // to figure out how they go to bytes.
    if (!isMaybeDeSoPublicKey(params.ProfilePublicKeyBase58CheckOrUsername)) {
        return Promise.reject('must provide profile public key, not username for local transaction construction');
    }
    metadata.coinsToMintNanos = hexToBytes(params.CoinsToMintNanos.replace('0x', 'x'));
    metadata.profilePublicKey = bs58PublicKeyToCompressedBytes(params.ProfilePublicKeyBase58CheckOrUsername);
    metadata.operationType = 0;
    return constructBalanceModelTx(params.UpdaterPublicKeyBase58Check, metadata, {
        ExtraData: params.ExtraData,
        MinFeeRateNanosPerKB: params.MinFeeRateNanosPerKB,
        TransactionFees: params.TransactionFees,
    });
};
export const updateDeSoTokenTransferRestrictionStatus = (params, options) => {
    return handleSignAndSubmit('api/v0/dao-coin', {
        ...params,
        OperationType: 'update_transfer_restriction_status',
    }, {
        ...options,
        constructionFunction: constructUpdateDeSoTokenTransferRestrictionStatusTransaction,
    });
};
export const constructUpdateDeSoTokenTransferRestrictionStatusTransaction = (params) => {
    const metadata = new TransactionMetadataDAOCoin();
    // TODO: I know we're passing hex strings representing uint256, but need
    // to figure out how they go to bytes.
    if (!isMaybeDeSoPublicKey(params.ProfilePublicKeyBase58CheckOrUsername)) {
        return Promise.reject('must provide profile public key, not username for local transaction construction');
    }
    metadata.profilePublicKey = bs58PublicKeyToCompressedBytes(params.ProfilePublicKeyBase58CheckOrUsername);
    metadata.operationType = 3;
    let transferRestrictionStatus;
    switch (params.TransferRestrictionStatus) {
        case 'dao_members_only':
            transferRestrictionStatus = 2;
            break;
        case 'permanently_unrestricted':
            transferRestrictionStatus = 3;
            break;
        case 'profile_owner_only':
            transferRestrictionStatus = 1;
            break;
        case 'unrestricted':
            transferRestrictionStatus = 0;
            break;
        default:
            return Promise.reject('invalid transfer restriction status value');
    }
    metadata.transferRestrictionStatus = transferRestrictionStatus;
    return constructBalanceModelTx(params.UpdaterPublicKeyBase58Check, metadata, {
        ExtraData: params.ExtraData,
        MinFeeRateNanosPerKB: params.MinFeeRateNanosPerKB,
        TransactionFees: params.TransactionFees,
    });
};
export const disableMintingDeSoToken = (params, options) => {
    return handleSignAndSubmit('api/v0/dao-coin', {
        ...params,
        OperationType: 'disable_minting',
    }, { ...options, constructionFunction: constructDisableMintingDeSoToken });
};
export const constructDisableMintingDeSoToken = (params) => {
    const metadata = new TransactionMetadataDAOCoin();
    // TODO: I know we're passing hex strings representing uint256, but need
    // to figure out how they go to bytes.
    if (!isMaybeDeSoPublicKey(params.ProfilePublicKeyBase58CheckOrUsername)) {
        return Promise.reject('must provide profile public key, not username for local transaction construction');
    }
    metadata.profilePublicKey = bs58PublicKeyToCompressedBytes(params.ProfilePublicKeyBase58CheckOrUsername);
    metadata.operationType = 2;
    return constructBalanceModelTx(params.UpdaterPublicKeyBase58Check, metadata, {
        ExtraData: params.ExtraData,
        MinFeeRateNanosPerKB: params.MinFeeRateNanosPerKB,
        TransactionFees: params.TransactionFees,
    });
};
/**
 * https://docs.deso.org/deso-backend/construct-transactions/dao-transactions-api#transfer-deso-token-dao-coin
 */
export const transferDeSoToken = (params, options) => {
    return handleSignAndSubmit('api/v0/transfer-dao-coin', params, {
        ...options,
        constructionFunction: constructTransferDeSoToken,
    });
};
export const constructTransferDeSoToken = (params) => {
    if (!isMaybeDeSoPublicKey(params.ProfilePublicKeyBase58CheckOrUsername)) {
        return Promise.reject('must provide profile public key, not username for local transaction construction');
    }
    const metadata = new TransactionMetadataTransferDAOCoin();
    metadata.daoCoinToTransferNanos = hexToBytes(params.DAOCoinToTransferNanos.replace('0x', 'x'));
    metadata.profilePublicKey = bs58PublicKeyToCompressedBytes(params.ProfilePublicKeyBase58CheckOrUsername);
    metadata.receiverPublicKey = bs58PublicKeyToCompressedBytes(params.ReceiverPublicKeyBase58CheckOrUsername);
    return constructBalanceModelTx(params.SenderPublicKeyBase58Check, metadata, {
        ExtraData: params.ExtraData,
        MinFeeRateNanosPerKB: params.MinFeeRateNanosPerKB,
        TransactionFees: params.TransactionFees,
    });
};
// TODO: Balance model transaction construction for limit orders.
/**
 * https://docs.deso.org/deso-backend/construct-transactions/dao-transactions-api#create-deso-token-dao-coin-limit-order
 */
export const createDeSoTokenLimitOrder = (params, options) => {
    return handleSignAndSubmit('api/v0/create-dao-coin-limit-order', {
        ...params,
    }, options);
};
export const createDeSoTokenMarketOrder = (params, options) => {
    return handleSignAndSubmit('api/v0/create-dao-coin-market-order', {
        ...params,
    }, options);
};
export const buyDeSoTokenMarketOrder = (params, options) => {
    return handleSignAndSubmit('api/v0/create-dao-coin-market-order', {
        ...params,
        SellingDAOCoinCreatorPublicKeyBase58Check: '',
        OperationType: 'BID',
    }, options);
};
export const sellDeSoTokenMarketOrder = (params, options) => {
    return handleSignAndSubmit('api/v0/create-dao-coin-market-order', {
        ...params,
        SellingDAOCoinCreatorPublicKeyBase58Check: '',
        OperationType: 'ASK',
    }, options);
};
/**
 * https://docs.deso.org/deso-backend/construct-transactions/dao-transactions-api#cancel-deso-token-dao-coin-limit-order
 */
export const cancelDeSoTokenLimitOrder = (params, options) => {
    return handleSignAndSubmit('api/v0/cancel-dao-coin-limit-order', params, options);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVzby10b2tlbnMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvdHJhbnNhY3Rpb25zL2Rlc28tdG9rZW5zLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQWdCakQsT0FBTyxFQUNMLDBCQUEwQixFQUMxQixrQ0FBa0MsRUFDbEMsOEJBQThCLEdBQy9CLE1BQU0sc0JBQXNCLENBQUM7QUFDOUIsT0FBTyxFQUNMLHVCQUF1QixFQUN2QixtQkFBbUIsRUFDbkIsb0JBQW9CLEdBQ3JCLE1BQU0sZ0JBQWdCLENBQUM7QUFjeEIsTUFBTSxDQUFDLE1BQU0sYUFBYSxHQUFHLENBQzNCLE1BQTJDLEVBQzNDLE9BQXdCLEVBQzZCLEVBQUU7SUFDdkQsT0FBTyxtQkFBbUIsQ0FDeEIsaUJBQWlCLEVBQ2pCO1FBQ0UsR0FBRyxNQUFNO1FBQ1QsYUFBYSxFQUFFLE1BQU07S0FDdEIsRUFDRCxFQUFFLEdBQUcsT0FBTyxFQUFFLG9CQUFvQixFQUFFLGlDQUFpQyxFQUFFLENBQ3hFLENBQUM7QUFDSixDQUFDLENBQUM7QUFFRixNQUFNLENBQUMsTUFBTSxpQ0FBaUMsR0FBRyxDQUMvQyxNQUEyQyxFQUNGLEVBQUU7SUFDM0MsTUFBTSxRQUFRLEdBQUcsSUFBSSwwQkFBMEIsRUFBRSxDQUFDO0lBQ2xELHdFQUF3RTtJQUN4RSxzQ0FBc0M7SUFDdEMsSUFBSSxDQUFDLG9CQUFvQixDQUFDLE1BQU0sQ0FBQyxxQ0FBcUMsQ0FBQyxFQUFFO1FBQ3ZFLE9BQU8sT0FBTyxDQUFDLE1BQU0sQ0FDbkIsa0ZBQWtGLENBQ25GLENBQUM7S0FDSDtJQUNELFFBQVEsQ0FBQyxnQkFBZ0IsR0FBRyxVQUFVLENBQ3BDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUMzQyxDQUFDO0lBQ0YsUUFBUSxDQUFDLGdCQUFnQixHQUFHLDhC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Q0FBQztBQUNKLENBQUMsQ0FBQztBQUVGOztHQUVHO0FBQ0gsTUFBTSxDQUFDLE1BQU0seUJBQXlCLEdBQUcsQ0FDdkMsTUFBd0YsRUFDeEYsT0FBd0IsRUFDa0MsRUFBRTtJQUM1RCxPQUFPLG1CQUFtQixDQUN4QixvQ0FBb0MsRUFDcEMsTUFBTSxFQUNOLE9BQU8sQ0FDUixDQUFDO0FBQ0osQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgaGV4VG9CeXRlcyB9IGZyb20gJ0Bub2JsZS9oYXNoZXMvdXRpbHMnO1xuaW1wb3J0IHtcbiAgQ29uc3RydWN0ZWRUcmFuc2FjdGlvblJlc3BvbnNlLFxuICBEQU9Db2luTGltaXRPcmRlclJlcXVlc3QsXG4gIERBT0NvaW5PcmRlclJlc3BvbnNlLFxuICBEQU9Db2luTGltaXRPcmRlcldpdGhDYW5jZWxPcmRlcklEUmVxdWVzdCxcbiAgREFPQ29pbkxpbWl0T3JkZXJXaXRoRXhjaGFuZ2VSYXRlQW5kUXVhbnRpdHlSZXF1ZXN0LFxuICBEQU9Db2luUmVxdWVzdCxcbiAgREFPQ29pblJlc3BvbnNlLFxuICBSZXF1ZXN0T3B0aW9ucyxcbiAgVHJhbnNmZXJEQU9Db2luUmVxdWVzdCxcbiAgVHJhbnNmZXJEQU9Db2luUmVzcG9uc2UsXG4gIFR4UmVxdWVzdFdpdGhPcHRpb25hbEZlZXNBbmRFeHRyYURhdGEsXG4gIERBT0NvaW5NYXJrZXRPcmRlclJlcXVlc3QsXG59IGZyb20gJy4uL2JhY2tlbmQtdHlwZXMvaW5kZXguanMnO1xuaW1wb3J0IHsgUGFydGlhbFdpdGhSZXF1aXJlZEZpZWxkcyB9IGZyb20gJy4uL2RhdGEvaW5kZXguanMnO1xuaW1wb3J0IHtcbiAgVHJhbnNhY3Rpb25NZXRhZGF0YURBT0NvaW4sXG4gIFRyYW5zYWN0aW9uTWV0YWRhdGFUcmFuc2ZlckRBT0NvaW4sXG4gIGJzNThQdWJsaWNLZXlUb0NvbXByZXNzZWRCeXRlcyxcbn0gZnJvbSAnLi4vaWRlbnRpdHkvaW5kZXguanMnO1xuaW1wb3J0IHtcbiAgY29uc3RydWN0QmFsYW5jZU1vZGVsVHgsXG4gIGhhbmRsZVNpZ25BbmRTdWJtaXQsXG4gIGlzTWF5YmVEZVNvUHVibGljS2V5LFxufSBmcm9tICcuLi9pbnRlcm5hbC5qcyc7XG5pbXBvcnQgeyBDb25zdHJ1Y3RlZEFuZFN1Ym1pdHRlZFR4IH0gZnJvbSAnLi4vdHlwZXMuanMnO1xuLyoqXG4gKiBodHRwczovL2RvY3MuZGVzby5vcmcvZGVzby1iYWNrZW5kL2NvbnN0cnVjdC10cmFuc2FjdGlvbnMvZGFvLXRyYW5zYWN0aW9ucy1hcGkjY3JlYXRlLWRlc28tdG9rZW4tZGFvLWNvaW5cbiAqL1xuZXhwb3J0IHR5cGUgQ29uc3RydWN0QnVybkRlU29Ub2tlblJlcXVlc3RQYXJhbXMgPVxuICBUeFJlcXVlc3RXaXRoT3B0aW9uYWxGZWVzQW5kRXh0cmFEYXRhPFxuICAgIFBhcnRpYWxXaXRoUmVxdWlyZWRGaWVsZHM8XG4gICAgICBPbWl0PERBT0NvaW5SZXF1ZXN0LCAnT3BlcmF0aW9uVHlwZSc+LFxuICAgICAgfCAnVXBkYXRlclB1YmxpY0tleUJhc2U1OENoZWNrJ1xuICAgICAgfCAnUHJvZmlsZVB1YmxpY0tleUJhc2U1OENoZWNrT3JVc2VybmFtZSdcbiAgICAgIHwgJ0NvaW5zVG9CdXJuTmFub3MnXG4gICAgPlxuICA+O1xuZXhwb3J0IGNvbnN0IGJ1cm5EZVNvVG9rZW4gPSAoXG4gIHBhcmFtczogQ29uc3RydWN0QnVybkRlU29Ub2tlblJlcXVlc3RQYXJhbXMsXG4gIG9wdGlvbnM/OiBSZXF1ZXN0T3B0aW9uc1xuKTogUHJvbWlzZTxDb25zdHJ1Y3RlZEFuZFN1Ym1pdHRlZFR4PERBT0NvaW5SZXNwb25zZT4+ID0+IHtcbiAgcmV0dXJuIGhhbmRsZVNpZ25BbmRTdWJtaXQoXG4gICAgJ2FwaS92MC9kYW8tY29pbicsXG4gICAge1xuICAgICAgLi4ucGFyYW1zLFxuICAgICAgT3BlcmF0aW9uVHlwZTogJ2J1cm4nLFxuICAgIH0sXG4gICAgeyAuLi5vcHRpb25zLCBjb25zdHJ1Y3Rpb25GdW5jdGlvbjogY29uc3RydWN0QnVybkRlU29Ub2tlblRyYW5zYWN0aW9uIH1cbiAgKTtcbn07XG5cbmV4cG9ydCBjb25zdCBjb25zdHJ1Y3RCdXJuRGVTb1Rva2VuVHJhbnNhY3Rpb24gPSAoXG4gIHBhcmFtczogQ29uc3RydWN0QnVybkRlU29Ub2tlblJlcXVlc3RQYXJhbXNcbik6IFByb21pc2U8Q29uc3RydWN0ZWRUcmFuc2FjdGlvblJlc3BvbnNlPiA9PiB7XG4gIGNvbnN0IG1ldGFkYXRhID0gbmV3IFRyYW5zYWN0aW9uTWV0YWRhdGFEQU9Db2luKCk7XG4gIC8vIFRPRE86IEkga25vdyB3ZSdyZSBwYXNzaW5nIGhleCBzdHJpbmdzIHJlcHJlc2VudGluZyB1aW50MjU2LCBidXQgbmVlZFxuICAvLyB0byBmaWd1cmUgb3V0IGhvdyB0aGV5IGdvIHRvIGJ5dGVzLlxuICBpZiAoIWlzTWF5YmVEZVNvUHVibGljS2V5KHBhcmFtcy5Qcm9maWxlUHVibGljS2V5QmFzZTU4Q2hlY2tPclVzZXJuYW1lKSkge1xuICAgIHJldHVybiBQcm9taXNlLnJlamVjdChcbiAgICAgICdtdXN0IHByb3ZpZGUgcHJvZmlsZSBwdWJsaWMga2V5LCBub3QgdXNlcm5hbWUgZm9yIGxvY2FsIHRyYW5zYWN0aW9uIGNvbnN0cnVjdGlvbidcbiAgICApO1xuICB9XG4gIG1ldGFkYXRhLmNvaW5zVG9CdXJuTmFub3MgPSBoZXhUb0J5dGVzKFxuICAgIHBhcmFtcy5Db2luc1RvQnVybk5hbm9zLnJlcGxhY2UoJzB4JywgJ3gnKVxuICApO1xuICBtZXRhZGF0YS5wcm9maWxlUHVibGljS2V5ID0gYnM1OFB1YmxpY0tleVRvQ29tcHJlc3NlZEJ5dGVzKFxuICAgIHBhcmFtcy5Qcm9maWxlUHVibGljS2V5QmFzZTU4Q2hlY2tPclVzZXJuYW1lXG4gICk7XG4gIG1ldGFkYXRhLm9wZXJhdGlvblR5cGUgPSAxO1xuICByZXR1cm4gY29uc3RydWN0QmFsYW5jZU1vZGVsVHgocGFyYW1zLlVwZGF0ZXJQdWJsaWNLZXlCYXNlNThDaGVjaywgbWV0YWRhdGEsIHtcbiAgICBFeHRyYURhdGE6IHBhcmFtcy5FeHRyYURhdGEsXG4gICAgTWluRmVlUmF0ZU5hbm9zUGVyS0I6IHBhcmFtcy5NaW5GZWVSYXRlTmFub3NQZXJLQixcbiAgICBUcmFuc2FjdGlvbkZlZXM6IHBhcmFtcy5UcmFuc2FjdGlvbkZlZXMsXG4gIH0pO1xufTtcblxuLyoqXG4gKiBodHRwczovL2RvY3MuZGVzby5vcmcvZGVzby1iYWNrZW5kL2NvbnN0cnVjdC10cmFuc2FjdGlvbnMvZGFvLXRyYW5zYWN0aW9ucy1hcGkjY3JlYXRlLWRlc28tdG9rZW4tZGFvLWNvaW5cbiAqL1xuZXhwb3J0IHR5cGUgTWludERlU29Ub2tlblJlcXVlc3RQYXJhbXMgPSBUeFJlcXVlc3RXaXRoT3B0aW9uYWxGZWVzQW5kRXh0cmFEYXRhPFxuICBQYXJ0aWFsV2l0aFJlcXVpcmVkRmllbGRzPFxuICAgIE9taXQ8REFPQ29pblJlcXVlc3QsICdPcGVyYXRpb25UeXBlJz4sXG4gICAgfCAnVXBkYXRlclB1YmxpY0tleUJhc2U1OENoZWNrJ1xuICAgIHwgJ1Byb2ZpbGVQdWJsaWNLZXlCYXNlNThDaGVja09yVXNlcm5hbWUnXG4gICAgfCAnQ29pbnNUb01pbnROYW5vcydcbiAgPlxuPjtcbmV4cG9ydCBjb25zdCBtaW50RGVTb1Rva2VuID0gKFxuICBwYXJhbXM6IE1pbnREZVNvVG9rZW5SZXF1ZXN0UGFyYW1zLFxuICBvcHRpb25zPzogUmVxdWVzdE9wdGlvbnNcbik6IFByb21pc2U8Q29uc3RydWN0ZWRBbmRTdWJtaXR0ZWRUeDxEQU9Db2luUmVzcG9uc2U+PiA9PiB7XG4gIHJldHVybiBoYW5kbGVTaWduQW5kU3VibWl0KFxuICAgICdhcGkvdjAvZGFvLWNvaW4nLFxuICAgIHtcbiAgICAgIC4uLnBhcmFtcyxcbiAgICAgIE9wZXJhdGlvblR5cGU6ICdtaW50JyxcbiAgICB9LFxuICAgIHsgLi4ub3B0aW9ucywgY29uc3RydWN0aW9uRnVuY3Rpb246IGNvbnN0cnVjdE1pbnREZVNvVG9rZW5UcmFuc2FjdGlvbiB9XG4gICk7XG59O1xuXG5leHBvcnQgY29uc3QgY29uc3RydWN0TWludERlU29Ub2tlblRyYW5zYWN0aW9uID0gKFxuICBwYXJhbXM6IE1pbnREZVNvVG9rZW5SZXF1ZXN0UGFyYW1zXG4pOiBQcm9taXNlPENvbnN0cnVjdGVkVHJhbnNhY3Rpb25SZXNwb25zZT4gPT4ge1xuICBjb25zdCBtZXRhZGF0YSA9IG5ldyBUcmFuc2FjdGlvbk1ldGFkYXRhREFPQ29pbigpO1xuICAvLyBUT0RPOiBJIGtub3cgd2UncmUgcGFzc2luZyBoZXggc3RyaW5ncyByZXByZXNlbnRpbmcgdWludDI1NiwgYnV0IG5lZWRcbiAgLy8gdG8gZmlndXJlIG91dCBob3cgdGhleSBnbyB0byBieXRlcy5cbiAgaWYgKCFpc01heWJlRGVTb1B1YmxpY0tleShwYXJhbXMuUHJvZmlsZVB1YmxpY0tleUJhc2U1OENoZWNrT3JVc2VybmFtZSkpIHtcbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoXG4gICAgICAnbXVzdCBwcm92aWRlIHByb2ZpbGUgcHVibGljIGtleSwgbm90IHVzZXJuYW1lIGZvciBsb2NhbCB0cmFuc2FjdGlvbiBjb25zdHJ1Y3Rpb24nXG4gICAgKTtcbiAgfVxuICBtZXRhZGF0YS5jb2luc1RvTWludE5hbm9zID0gaGV4VG9CeXRlcyhcbiAgICBwYXJhbXMuQ29pbnNUb01pbnROYW5vcy5yZXBsYWNlKCcweCcsICd4JylcbiAgKTtcbiAgbWV0YWRhdGEucHJvZmlsZVB1YmxpY0tleSA9IGJzNThQdWJsaWNLZXlUb0NvbXByZXNzZWRCeXRlcyhcbiAgICBwYXJhbXMuUHJvZmlsZVB1YmxpY0tleUJhc2U1OENoZWNrT3JVc2VybmFtZVxuICApO1xuICBtZXRhZGF0YS5vcGVyYXRpb25UeXBlID0gMDtcbiAgcmV0dXJuIGNvbnN0cnVjdEJhbGFuY2VNb2RlbFR4KHBhcmFtcy5VcGRhdGVyUHVibGljS2V5QmFzZTU4Q2hlY2ssIG1ldGFkYXRhLCB7XG4gICAgRXh0cmFEYXRhOiBwYXJhbXMuRXh0cmFEYXRhLFxuICAgIE1pbkZlZVJhdGVOYW5vc1BlcktCOiBwYXJhbXMuTWluRmVlUmF0ZU5hbm9zUGVyS0IsXG4gICAgVHJhbnNhY3Rpb25GZWVzOiBwYXJhbXMuVHJhbnNhY3Rpb25GZWVzLFxuICB9KTtcbn07XG5cbi8qKlxuICogaHR0cHM6Ly9kb2NzLmRlc28ub3JnL2Rlc28tYmFja2VuZC9jb25zdHJ1Y3QtdHJhbnNhY3Rpb25zL2Rhby10cmFuc2FjdGlvbnMtYXBpI2NyZWF0ZS1kZXNvLXRva2VuLWRhby1jb2luXG4gKi9cbmV4cG9ydCB0eXBlIFVwZGF0ZURlU29Ub2tlblRyYW5zZmVyUmVzdHJpY3Rpb25TdGF0dXNSZXF1ZXN0UGFyYW1zID1cbiAgVHhSZXF1ZXN0V2l0aE9wdGlvbmFsRmVlc0FuZEV4dHJhRGF0YTxcbiAgICBQYXJ0aWFsV2l0aFJlcXVpcmVkRmllbGRzPFxuICAgICAgT21pdDxEQU9Db2luUmVxdWVzdCwgJ09wZXJhdGlvblR5cGUnPixcbiAgICAgICdVcGRhdGVyUHVibGljS2V5QmFzZTU4Q2hlY2snIHwgJ1Byb2ZpbGVQdWJsaWNLZXlCYXNlNThDaGVja09yVXNlcm5hbWUnXG4gICAgPlxuICA+O1xuZXhwb3J0IGNvbnN0IHVwZGF0ZURlU29Ub2tlblRyYW5zZmVyUmVzdHJpY3Rpb25TdGF0dXMgPSAoXG4gIHBhcmFtczogVXBkYXRlRGVTb1Rva2VuVHJhbnNmZXJSZXN0cmljdGlvblN0YXR1c1JlcXVlc3RQYXJhbXMsXG4gIG9wdGlvbnM/OiBSZXF1ZXN0T3B0aW9uc1xuKTogUHJvbWlzZTxDb25zdHJ1Y3RlZEFuZFN1Ym1pdHRlZFR4PERBT0NvaW5SZXNwb25zZT4+ID0+IHtcbiAgcmV0dXJuIGhhbmRsZVNpZ25BbmRTdWJtaXQoXG4gICAgJ2FwaS92MC9kYW8tY29pbicsXG4gICAge1xuICAgICAgLi4ucGFyYW1zLFxuICAgICAgT3BlcmF0aW9uVHlwZTogJ3VwZGF0ZV90cmFuc2Zlcl9yZXN0cmljdGlvbl9zdGF0dXMnLFxuICAgIH0sXG4gICAge1xuICAgICAgLi4ub3B0aW9ucyxcbiAgICAgIGNvbnN0cnVjdGlvbkZ1bmN0aW9uOlxuICAgICAgICBjb25zdHJ1Y3RVcGRhdGVEZVNvVG9rZW5UcmFuc2ZlclJlc3RyaWN0aW9uU3RhdHVzVHJhbnNhY3Rpb24sXG4gICAgfVxuICApO1xufTtcblxuZXhwb3J0IGNvbnN0IGNvbnN0cnVjdFVwZGF0ZURlU29Ub2tlblRyYW5zZmVyUmVzdHJpY3Rpb25TdGF0dXNUcmFuc2FjdGlvbiA9IChcbiAgcGFyYW1zOiBVcGRhdGVEZVNvVG9rZW5UcmFuc2ZlclJlc3RyaWN0aW9uU3RhdHVzUmVxdWVzdFBhcmFtc1xuKTogUHJvbWlzZTxDb25zdHJ1Y3RlZFRyYW5zYWN0aW9uUmVzcG9uc2U+ID0+IHtcbiAgY29uc3QgbWV0YWRhdGEgPSBuZXcgVHJhbnNhY3Rpb25NZXRhZGF0YURBT0NvaW4oKTtcbiAgLy8gVE9ETzogSSBrbm93IHdlJ3JlIHBhc3NpbmcgaGV4IHN0cmluZ3MgcmVwcmVzZW50aW5nIHVpbnQyNTYsIGJ1dCBuZWVkXG4gIC8vIHRvIGZpZ3VyZSBvdXQgaG93IHRoZXkgZ28gdG8gYnl0ZXMuXG4gIGlmICghaXNNYXliZURlU29QdWJsaWNLZXkocGFyYW1zLlByb2ZpbGVQdWJsaWNLZXlCYXNlNThDaGVja09yVXNlcm5hbWUpKSB7XG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KFxuICAgICAgJ211c3QgcHJvdmlkZSBwcm9maWxlIHB1YmxpYyBrZXksIG5vdCB1c2VybmFtZSBmb3IgbG9jYWwgdHJhbnNhY3Rpb24gY29uc3RydWN0aW9uJ1xuICAgICk7XG4gIH1cbiAgbWV0YWRhdGEucHJvZmlsZVB1YmxpY0tleSA9IGJzNThQdWJsaWNLZXlUb0NvbXByZXNzZWRCeXRlcyhcbiAgICBwYXJhbXMuUHJvZmlsZVB1YmxpY0tleUJhc2U1OENoZWNrT3JVc2VybmFtZVxuICApO1xuICBtZXRhZGF0YS5vcGVyYXRpb25UeXBlID0gMztcbiAgbGV0IHRyYW5zZmVyUmVzdHJpY3Rpb25TdGF0dXM6IG51bWJlcjtcbiAgc3dpdGNoIChwYXJhbXMuVHJhbnNmZXJSZXN0cmljdGlvblN0YXR1cykge1xuICAgIGNhc2UgJ2Rhb19tZW1iZXJzX29ubHknOlxuICAgICAgdHJhbnNmZXJSZXN0cmljdGlvblN0YXR1cyA9IDI7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdwZXJtYW5lbnRseV91bnJlc3RyaWN0ZWQnOlxuICAgICAgdHJhbnNmZXJSZXN0cmljdGlvblN0YXR1cyA9IDM7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdwcm9maWxlX293bmVyX29ubHknOlxuICAgICAgdHJhbnNmZXJSZXN0cmljdGlvblN0YXR1cyA9IDE7XG4gICAgICBicmVhaztcbiAgICBjYXNlICd1bnJlc3RyaWN0ZWQnOlxuICAgICAgdHJhbnNmZXJSZXN0cmljdGlvblN0YXR1cyA9IDA7XG4gICAgICBicmVhaztcbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KCdpbnZhbGlkIHRyYW5zZmVyIHJlc3RyaWN0aW9uIHN0YXR1cyB2YWx1ZScpO1xuICB9XG4gIG1ldGFkYXRhLnRyYW5zZmVyUmVzdHJpY3Rpb25TdGF0dXMgPSB0cmFuc2ZlclJlc3RyaWN0aW9uU3RhdHVzO1xuICByZXR1cm4gY29uc3RydWN0QmFsYW5jZU1vZGVsVHgocGFyYW1zLlVwZGF0ZXJQdWJsaWNLZXlCYXNlNThDaGVjaywgbWV0YWRhdGEsIHtcbiAgICBFeHRyYURhdGE6IHBhcmFtcy5FeHRyYURhdGEsXG4gICAgTWluRmVlUmF0ZU5hbm9zUGVyS0I6IHBhcmFtcy5NaW5GZWVSYXRlTmFub3NQZXJLQixcbiAgICBUcmFuc2FjdGlvbkZlZXM6IHBhcmFtcy5UcmFuc2FjdGlvbkZlZXMsXG4gIH0pO1xufTtcblxuZXhwb3J0IHR5cGUgRGlzYWJsZU1pbnRpbmdEZVNvVG9rZW5SZXF1ZXN0UGFyYW1zID1cbiAgVHhSZXF1ZXN0V2l0aE9wdGlvbmFsRmVlc0FuZEV4dHJhRGF0YTxcbiAgICBQYXJ0aWFsV2l0aFJlcXVpcmVkRmllbGRzPFxuICAgICAgT21pdDxEQU9Db2luUmVxdWVzdCwgJ09wZXJhdGlvblR5cGUnPixcbiAgICAgICdVcGRhdGVyUHVibGljS2V5QmFzZTU4Q2hlY2snIHwgJ1Byb2ZpbGVQdWJsaWNLZXlCYXNlNThDaGVja09yVXNlcm5hbWUnXG4gICAgPlxuICA+O1xuZXhwb3J0IGNvbnN0IGRpc2FibGVNaW50aW5nRGVTb1Rva2VuID0gKFxuICBwYXJhbXM6IERpc2FibGVNaW50aW5nRGVTb1Rva2VuUmVxdWVzdFBhcmFtcyxcbiAgb3B0aW9ucz86IFJlcXVlc3RPcHRpb25zXG4pOiBQcm9taXNlPENvbnN0cnVjdGVkQW5kU3VibWl0dGVkVHg8REFPQ29pblJlc3BvbnNlPj4gPT4ge1xuICByZXR1cm4gaGFuZGxlU2lnbkFuZFN1Ym1pdChcbiAgICAnYXBpL3YwL2Rhby1jb2luJyxcbiAgICB7XG4gICAgICAuLi5wYXJhbXMsXG4gICAgICBPcGVyYXRpb25UeXBlOiAnZGlzYWJsZV9taW50aW5nJyxcbiAgICB9LFxuICAgIHsgLi4ub3B0aW9ucywgY29uc3RydWN0aW9uRnVuY3Rpb246IGNvbnN0cnVjdERpc2FibGVNaW50aW5nRGVTb1Rva2VuIH1cbiAgKTtcbn07XG5cbmV4cG9ydCBjb25zdCBjb25zdHJ1Y3REaXNhYmxlTWludGluZ0RlU29Ub2tlbiA9IChcbiAgcGFyYW1zOiBEaXNhYmxlTWludGluZ0RlU29Ub2tlblJlcXVlc3RQYXJhbXNcbik6IFByb21pc2U8Q29uc3RydWN0ZWRUcmFuc2FjdGlvblJlc3BvbnNlPiA9PiB7XG4gIGNvbnN0IG1ldGFkYXRhID0gbmV3IFRyYW5zYWN0aW9uTWV0YWRhdGFEQU9Db2luKCk7XG4gIC8vIFRPRE86IEkga25vdyB3ZSdyZSBwYXNzaW5nIGhleCBzdHJpbmdzIHJlcHJlc2VudGluZyB1aW50MjU2LCBidXQgbmVlZFxuICAvLyB0byBmaWd1cmUgb3V0IGhvdyB0aGV5IGdvIHRvIGJ5dGVzLlxuICBpZiAoIWlzTWF5YmVEZVNvUHVibGljS2V5KHBhcmFtcy5Qcm9maWxlUHVibGljS2V5QmFzZTU4Q2hlY2tPclVzZXJuYW1lKSkge1xuICAgIHJldHVybiBQcm9taXNlLnJlamVjdChcbiAgICAgICdtdXN0IHByb3ZpZGUgcHJvZmlsZSBwdWJsaWMga2V5LCBub3QgdXNlcm5hbWUgZm9yIGxvY2FsIHRyYW5zYWN0aW9uIGNvbnN0cnVjdGlvbidcbiAgICApO1xuICB9XG4gIG1ldGFkYXRhLnByb2ZpbGVQdWJsaWNLZXkgPSBiczU4UHVibGljS2V5VG9Db21wcmVzc2VkQnl0ZXMoXG4gICAgcGFyYW1zLlByb2ZpbGVQdWJsaWNLZXlCYXNlNThDaGVja09yVXNlcm5hbWVcbiAgKTtcbiAgbWV0YWRhdGEub3BlcmF0aW9uVHlwZSA9IDI7XG4gIHJldHVybiBjb25zdHJ1Y3RCYWxhbmNlTW9kZWxUeChwYXJhbXMuVXBkYXRlclB1YmxpY0tleUJhc2U1OENoZWNrLCBtZXRhZGF0YSwge1xuICAgIEV4dHJhRGF0YTogcGFyYW1zLkV4dHJhRGF0YSxcbiAgICBNaW5GZWVSYXRlTmFub3NQZXJLQjogcGFyYW1zLk1pbkZlZVJhdGVOYW5vc1BlcktCLFxuICAgIFRyYW5zYWN0aW9uRmVlczogcGFyYW1zLlRyYW5zYWN0aW9uRmVlcyxcbiAgfSk7XG59O1xuXG4vKipcbiAqIGh0dHBzOi8vZG9jcy5kZXNvLm9yZy9kZXNvLWJhY2tlbmQvY29uc3RydWN0LXRyYW5zYWN0aW9ucy9kYW8tdHJhbnNhY3Rpb25zLWFwaSN0cmFuc2Zlci1kZXNvLXRva2VuLWRhby1jb2luXG4gKi9cbmV4cG9ydCBjb25zdCB0cmFuc2ZlckRlU29Ub2tlbiA9IChcbiAgcGFyYW1zOiBUeFJlcXVlc3RXaXRoT3B0aW9uYWxGZWVzQW5kRXh0cmFEYXRhPFRyYW5zZmVyREFPQ29pblJlcXVlc3Q+LFxuICBvcHRpb25zPzogUmVxdWVzdE9wdGlvbnNcbik6IFByb21pc2U8Q29uc3RydWN0ZWRBbmRTdWJtaXR0ZWRUeDxUcmFuc2ZlckRBT0NvaW5SZXNwb25zZT4+ID0+IHtcbiAgcmV0dXJuIGhhbmRsZVNpZ25BbmRTdWJtaXQoJ2FwaS92MC90cmFuc2Zlci1kYW8tY29pbicsIHBhcmFtcywge1xuICAgIC4uLm9wdGlvbnMsXG4gICAgY29uc3RydWN0aW9uRnVuY3Rpb246IGNvbnN0cnVjdFRyYW5zZmVyRGVTb1Rva2VuLFxuICB9KTtcbn07XG5cbmV4cG9ydCBjb25zdCBjb25zdHJ1Y3RUcmFuc2ZlckRlU29Ub2tlbiA9IChcbiAgcGFyYW1zOiBUeFJlcXVlc3RXaXRoT3B0aW9uYWxGZWVzQW5kRXh0cmFEYXRhPFRyYW5zZmVyREFPQ29pblJlcXVlc3Q+XG4pOiBQcm9taXNlPENvbnN0cnVjdGVkVHJhbnNhY3Rpb25SZXNwb25zZT4gPT4ge1xuICBpZiAoIWlzTWF5YmVEZVNvUHVibGljS2V5KHBhcmFtcy5Qcm9maWxlUHVibGljS2V5QmFzZTU4Q2hlY2tPclVzZXJuYW1lKSkge1xuICAgIHJldHVybiBQcm9taXNlLnJlamVjdChcbiAgICAgICdtdXN0IHByb3ZpZGUgcHJvZmlsZSBwdWJsaWMga2V5LCBub3QgdXNlcm5hbWUgZm9yIGxvY2FsIHRyYW5zYWN0aW9uIGNvbnN0cnVjdGlvbidcbiAgICApO1xuICB9XG4gIGNvbnN0IG1ldGFkYXRhID0gbmV3IFRyYW5zYWN0aW9uTWV0YWRhdGFUcmFuc2ZlckRBT0NvaW4oKTtcbiAgbWV0YWRhdGEuZGFvQ29pblRvVHJhbnNmZXJOYW5vcyA9IGhleFRvQnl0ZXMoXG4gICAgcGFyYW1zLkRBT0NvaW5Ub1RyYW5zZmVyTmFub3MucmVwbGFjZSgnMHgnLCAneCcpXG4gICk7XG4gIG1ldGFkYXRhLnByb2ZpbGVQdWJsaWNLZXkgPSBiczU4UHVibGljS2V5VG9Db21wcmVzc2VkQnl0ZXMoXG4gICAgcGFyYW1zLlByb2ZpbGVQdWJsaWNLZXlCYXNlNThDaGVja09yVXNlcm5hbWVcbiAgKTtcbiAgbWV0YWRhdGEucmVjZWl2ZXJQdWJsaWNLZXkgPSBiczU4UHVibGljS2V5VG9Db21wcmVzc2VkQnl0ZXMoXG4gICAgcGFyYW1zLlJlY2VpdmVyUHVibGljS2V5QmFzZTU4Q2hlY2tPclVzZXJuYW1lXG4gICk7XG4gIHJldHVybiBjb25zdHJ1Y3RCYWxhbmNlTW9kZWxUeChwYXJhbXMuU2VuZGVyUHVibGljS2V5QmFzZTU4Q2hlY2ssIG1ldGFkYXRhLCB7XG4gICAgRXh0cmFEYXRhOiBwYXJhbXMuRXh0cmFEYXRhLFxuICAgIE1pbkZlZVJhdGVOYW5vc1BlcktCOiBwYXJhbXMuTWluRmVlUmF0ZU5hbm9zUGVyS0IsXG4gICAgVHJhbnNhY3Rpb25GZWVzOiBwYXJhbXMuVHJhbnNhY3Rpb25GZWVzLFxuICB9KTtcbn07XG5cbi8vIFRPRE86IEJhbGFuY2UgbW9kZWwgdHJhbnNhY3Rpb24gY29uc3RydWN0aW9uIGZvciBsaW1pdCBvcmRlcnMuXG4vKipcbiAqIGh0dHBzOi8vZG9jcy5kZXNvLm9yZy9kZXNvLWJhY2tlbmQvY29uc3RydWN0LXRyYW5zYWN0aW9ucy9kYW8tdHJhbnNhY3Rpb25zLWFwaSNjcmVhdGUtZGVzby10b2tlbi1kYW8tY29pbi1saW1pdC1vcmRlclxuICovXG5leHBvcnQgY29uc3QgY3JlYXRlRGVTb1Rva2VuTGltaXRPcmRlciA9IChcbiAgcGFyYW1zOiBEQU9Db2luTGltaXRPcmRlclJlcXVlc3QsXG4gIG9wdGlvbnM/OiBSZXF1ZXN0T3B0aW9uc1xuKTogUHJvbWlzZTxDb25zdHJ1Y3RlZEFuZFN1Ym1pdHRlZFR4PERBT0NvaW5PcmRlclJlc3BvbnNlPj4gPT4ge1xuICByZXR1cm4gaGFuZGxlU2lnbkFuZFN1Ym1pdChcbiAgICAnYXBpL3YwL2NyZWF0ZS1kYW8tY29pbi1saW1pdC1vcmRlcicsXG4gICAge1xuICAgICAgLi4ucGFyYW1zLFxuICAgIH0sXG4gICAgb3B0aW9uc1xuICApO1xufTtcblxuZXhwb3J0IGNvbnN0IGNyZWF0ZURlU29Ub2tlbk1hcmtldE9yZGVyID0gKFxuICBwYXJhbXM6IERBT0NvaW5NYXJrZXRPcmRlclJlcXVlc3QsXG4gIG9wdGlvbnM/OiBSZXF1ZXN0T3B0aW9uc1xuKTogUHJvbWlzZTxDb25zdHJ1Y3RlZEFuZFN1Ym1pdHRlZFR4PERBT0NvaW5PcmRlclJlc3BvbnNlPj4gPT4ge1xuICByZXR1cm4gaGFuZGxlU2lnbkFuZFN1Ym1pdChcbiAgICAnYXBpL3YwL2NyZWF0ZS1kYW8tY29pbi1tYXJrZXQtb3JkZXInLFxuICAgIHtcbiAgICAgIC4uLnBhcmFtcyxcbiAgICB9LFxuICAgIG9wdGlvbnNcbiAgKTtcbn07XG5cbmV4cG9ydCBjb25zdCBidXlEZVNvVG9rZW5NYXJrZXRPcmRlciA9IChcbiAgcGFyYW1zOiBQYXJ0aWFsV2l0aFJlcXVpcmVkRmllbGRzPFxuICAgIE9taXQ8XG4gICAgICBEQU9Db2luTWFya2V0T3JkZXJSZXF1ZXN0LFxuICAgICAgJ1NlbGxpbmdEQU9Db2luQ3JlYXRvclB1YmxpY0tleUJhc2U1OENoZWNrJyB8ICdPcGVyYXRpb25UeXBlJ1xuICAgID4sXG4gICAgfCAnVHJhbnNhY3RvclB1YmxpY0tleUJhc2U1OENoZWNrJ1xuICAgIHwgJ0J1eWluZ0RBT0NvaW5DcmVhdG9yUHVibGljS2V5QmFzZTU4Q2hlY2snXG4gICAgfCAnUXVhbnRpdHknXG4gID4sXG4gIG9wdGlvbnM/OiBSZXF1ZXN0T3B0aW9uc1xuKTogUHJvbWlzZTxDb25zdHJ1Y3RlZEFuZFN1Ym1pdHRlZFR4PERBT0NvaW5PcmRlclJlc3BvbnNlPj4gPT4ge1xuICByZXR1cm4gaGFuZGxlU2lnbkFuZFN1Ym1pdChcbiAgICAnYXBpL3YwL2NyZWF0ZS1kYW8tY29pbi1tYXJrZXQtb3JkZXInLFxuICAgIHtcbiAgICAgIC4uLnBhcmFtcyxcbiAgICAgIFNlbGxpbmdEQU9Db2luQ3JlYXRvclB1YmxpY0tleUJhc2U1OENoZWNrOiAnJyxcbiAgICAgIE9wZXJhdGlvblR5cGU6ICdCSUQnLFxuICAgIH0sXG4gICAgb3B0aW9uc1xuICApO1xufTtcblxuZXhwb3J0IGNvbnN0IHNlbGxEZVNvVG9rZW5NYXJrZXRPcmRlciA9IChcbiAgcGFyYW1zOiBQYXJ0aWFsV2l0aFJlcXVpcmVkRmllbGRzPFxuICAgIE9taXQ8XG4gICAgICBEQU9Db2luTWFya2V0T3JkZXJSZXF1ZXN0LFxuICAgICAgJ0J1eWluZ0RBT0NvaW5DcmVhdG9yUHVibGljS2V5QmFzZTU4Q2hlY2snIHwgJ09wZXJhdGlvblR5cGUnXG4gICAgPixcbiAgICB8ICdUcmFuc2FjdG9yUHVibGljS2V5QmFzZTU4Q2hlY2snXG4gICAgfCAnU2VsbGluZ0RBT0NvaW5DcmVhdG9yUHVibGljS2V5QmFzZTU4Q2hlY2snXG4gICAgfCAnUXVhbnRpdHknXG4gID4sXG4gIG9wdGlvbnM/OiBSZXF1ZXN0T3B0aW9uc1xuKTogUHJvbWlzZTxDb25zdHJ1Y3RlZEFuZFN1Ym1pdHRlZFR4PERBT0NvaW5PcmRlclJlc3BvbnNlPj4gPT4ge1xuICByZXR1cm4gaGFuZGxlU2lnbkFuZFN1Ym1pdChcbiAgICAnYXBpL3YwL2NyZWF0ZS1kYW8tY29pbi1tYXJrZXQtb3JkZXInLFxuICAgIHtcbiAgICAgIC4uLnBhcmFtcyxcbiAgICAgIFNlbGxpbmdEQU9Db2luQ3JlYXRvclB1YmxpY0tleUJhc2U1OENoZWNrOiAnJyxcbiAgICAgIE9wZXJhdGlvblR5cGU6ICdBU0snLFxuICAgIH0sXG4gICAgb3B0aW9uc1xuICApO1xufTtcblxuLyoqXG4gKiBodHRwczovL2RvY3MuZGVzby5vcmcvZGVzby1iYWNrZW5kL2NvbnN0cnVjdC10cmFuc2FjdGlvbnMvZGFvLXRyYW5zYWN0aW9ucy1hcGkjY2FuY2VsLWRlc28tdG9rZW4tZGFvLWNvaW4tbGltaXQtb3JkZXJcbiAqL1xuZXhwb3J0IGNvbnN0IGNhbmNlbERlU29Ub2tlbkxpbWl0T3JkZXIgPSAoXG4gIHBhcmFtczogVHhSZXF1ZXN0V2l0aE9wdGlvbmFsRmVlc0FuZEV4dHJhRGF0YTxEQU9Db2luTGltaXRPcmRlcldpdGhDYW5jZWxPcmRlcklEUmVxdWVzdD4sXG4gIG9wdGlvbnM/OiBSZXF1ZXN0T3B0aW9uc1xuKTogUHJvbWlzZTxDb25zdHJ1Y3RlZEFuZFN1Ym1pdHRlZFR4PERBT0NvaW5PcmRlclJlc3BvbnNlPj4gPT4ge1xuICByZXR1cm4gaGFuZGxlU2lnbkFuZFN1Ym1pdChcbiAgICAnYXBpL3YwL2NhbmNlbC1kYW8tY29pbi1saW1pdC1vcmRlcicsXG4gICAgcGFyYW1zLFxuICAgIG9wdGlvbnNcbiAgKTtcbn07XG4iXX0=