import { hexToBytes } from '@noble/hashes/utils';
import { utils as ecUtils } from '@noble/secp256k1';
import { checkPartyAccessGroups, } from '../data/index.js';
import { DIAMOND_LEVEL_MAP } from '../identity/constants.js';
import { TransactionExtraDataKV, TransactionMetadataBasicTransfer, TransactionMetadataFollow, TransactionMetadataLike, TransactionMetadataNewMessage, TransactionMetadataSubmitPost, TransactionMetadataUpdateProfile, bs58PublicKeyToCompressedBytes, encodeUTF8ToBytes, identity, uvarint64ToBuf, } from '../identity/index.js';
import { constructBalanceModelTx, getTxWithFeeNanos, handleSignAndSubmit, sumTransactionFees, } from '../internal.js';
import { guardTxPermission } from './utils.js';
const buildUpdateProfileMetadata = (params) => {
    const metadata = new TransactionMetadataUpdateProfile();
    // TODO: this is broken.
    metadata.profilePublicKey =
        params.UpdaterPublicKeyBase58Check !== params.ProfilePublicKeyBase58Check
            ? bs58PublicKeyToCompressedBytes(params.ProfilePublicKeyBase58Check)
            : new Uint8Array(0);
    metadata.newUsername = encodeUTF8ToBytes(params.NewUsername ?? '');
    metadata.newDescription = encodeUTF8ToBytes(params.NewDescription ?? '');
    // TODO: we probably need something to handle the profile pic compression here.
    metadata.newProfilePic = encodeUTF8ToBytes(params.NewProfilePic ?? '');
    metadata.newCreatorBasisPoints = params.NewCreatorBasisPoints;
    metadata.newStakeMultipleBasisPoints = params.NewStakeMultipleBasisPoints;
    metadata.isHidden = params.IsHidden ?? false;
    return metadata;
};
export const constructUpdateProfileTransaction = (params) => {
    return constructBalanceModelTx(params.UpdaterPublicKeyBase58Check, buildUpdateProfileMetadata(params), {
        ExtraData: params.ExtraData,
        MinFeeRateNanosPerKB: params.MinFeeRateNanosPerKB,
        TransactionFees: params.TransactionFees,
    });
};
/**
 * https://docs.deso.org/deso-backend/construct-transactions/social-transactions-api#update-profile
 */
export const updateProfile = async (params, options) => {
    const txWithFee = getTxWithFeeNanos(params.UpdaterPublicKeyBase58Check, buildUpdateProfileMetadata(params), {
        ExtraData: params.ExtraData,
        MinFeeRateNanosPerKB: params.MinFeeRateNanosPerKB,
        TransactionFees: params.TransactionFees,
    });
    if (options?.checkPermissions !== false) {
        await guardTxPermission({
            GlobalDESOLimit: txWithFee.feeNanos + sumTransactionFees(params.TransactionFees),
            TransactionCountLimitMap: {
                UPDATE_PROFILE: options?.txLimitCount ??
                    identity.transactionSpendingLimitOptions?.TransactionCountLimitMap
                        ?.UPDATE_PROFILE ??
                    1,
            },
        });
    }
    return handleSignAndSubmit('api/v0/update-profile', params, {
        ...options,
        constructionFunction: constructUpdateProfileTransaction,
    });
};
const buildSubmitPostMetadata = (params) => {
    const metadata = new TransactionMetadataSubmitPost();
    const BodyObjCopy = {};
    Object.keys(params.BodyObj).forEach((k) => {
        const key = k;
        const value = params.BodyObj[key];
        if (!value)
            return;
        if (Array.isArray(value) && value.length > 0) {
            BodyObjCopy[key] = value;
        }
        else {
            BodyObjCopy[key] = value;
        }
    });
    metadata.body = encodeUTF8ToBytes(JSON.stringify(BodyObjCopy));
    metadata.creatorBasisPoints = 1000;
    metadata.stakeMultipleBasisPoints = 12500;
    metadata.timestampNanos = Math.ceil(1e6 * (globalThis.performance.timeOrigin + globalThis.performance.now()));
    metadata.isHidden = !!params.IsHidden;
    metadata.parentStakeId = hexToBytes(params.ParentStakeID || '');
    metadata.postHashToModify = hexToBytes(params.PostHashHexToModify || '');
    return metadata;
};
const buildSubmitPostConsensusKVs = (params) => {
    const extraDataKVs = [];
    if (params.RepostedPostHashHex) {
        extraDataKVs.push(new TransactionExtraDataKV(encodeUTF8ToBytes('RecloutedPostHash'), hexToBytes(params.RepostedPostHashHex)));
        extraDataKVs.push(new TransactionExtraDataKV(encodeUTF8ToBytes('IsQuotedReclout'), Uint8Array.from([
            !params.BodyObj.Body &&
                !params.BodyObj.ImageURLs?.length &&
                !params.BodyObj.VideoURLs?.length
                ? 0
                : 1,
        ])));
    }
    return extraDataKVs;
};
export const constructSubmitPost = (params) => {
    return constructBalanceModelTx(params.UpdaterPublicKeyBase58Check, buildSubmitPostMetadata(params), {
        ExtraData: params.ExtraData,
        ConsensusExtraDataKVs: buildSubmitPostConsensusKVs(params),
        MinFeeRateNanosPerKB: params.MinFeeRateNanosPerKB,
        TransactionFees: params.TransactionFees,
    });
};
export const submitPost = async (params, options) => {
    const txWithFee = getTxWithFeeNanos(params.UpdaterPublicKeyBase58Check, buildSubmitPostMetadata(params), {
        ExtraData: params.ExtraData,
        ConsensusExtraDataKVs: buildSubmitPostConsensusKVs(params),
        MinFeeRateNanosPerKB: params.MinFeeRateNanosPerKB,
        TransactionFees: params.TransactionFees,
    });
    if (options?.checkPermissions !== false) {
        await guardTxPermission({
            GlobalDESOLimit: txWithFee.feeNanos + sumTransactionFees(params.TransactionFees),
            TransactionCountLimitMap: {
                SUBMIT_POST: options?.txLimitCount ??
                    identity.transactionSpendingLimitOptions?.TransactionCountLimitMap
                        ?.SUBMIT_POST ??
                    1,
            },
        });
    }
    return handleSignAndSubmit('api/v0/submit-post', params, {
        ...options,
        constructionFunction: constructSubmitPost,
    });
};
export const updateFollowingStatus = async (params, options) => {
    const txWithFee = getTxWithFeeNanos(params.FollowerPublicKeyBase58Check, buildFollowMetadata(params), {
        ExtraData: params.ExtraData,
        MinFeeRateNanosPerKB: params.MinFeeRateNanosPerKB,
        TransactionFees: params.TransactionFees,
    });
    if (options?.checkPermissions !== false) {
        await guardTxPermission({
            GlobalDESOLimit: txWithFee.feeNanos + sumTransactionFees(params.TransactionFees),
            TransactionCountLimitMap: {
                FOLLOW: options?.txLimitCount ??
                    identity.transactionSpendingLimitOptions?.TransactionCountLimitMap
                        ?.FOLLOW ??
                    1,
            },
        });
    }
    return handleSignAndSubmit('api/v0/create-follow-txn-stateless', params, {
        ...options,
        constructionFunction: constructFollowTransaction,
    });
};
const buildFollowMetadata = (params) => {
    const metadata = new TransactionMetadataFollow();
    metadata.followedPublicKey = bs58PublicKeyToCompressedBytes(params.FollowedPublicKeyBase58Check);
    metadata.isUnfollow = !!params.IsUnfollow;
    return metadata;
};
export const constructFollowTransaction = (params) => {
    return constructBalanceModelTx(params.FollowerPublicKeyBase58Check, buildFollowMetadata(params), {
        ExtraData: params.ExtraData,
        MinFeeRateNanosPerKB: params.MinFeeRateNanosPerKB,
        TransactionFees: params.TransactionFees,
    });
};
/**
 * https://docs.deso.org/deso-backend/construct-transactions/social-transactions-api#send-diamonds
 */
export const sendDiamonds = async (params, options) => {
    const txWithFee = getTxWithFeeNanos(params.SenderPublicKeyBase58Check, new TransactionMetadataBasicTransfer(), {
        ExtraData: params.ExtraData,
        MinFeeRateNanosPerKB: params.MinFeeRateNanosPerKB,
        TransactionFees: params.TransactionFees,
        ConsensusExtraDataKVs: buildSendDiamondsConsensusKVs(params),
    });
    if (options?.checkPermissions !== false) {
        await guardTxPermission({
            GlobalDESOLimit: txWithFee.feeNanos +
                sumTransactionFees(params.TransactionFees) +
                DIAMOND_LEVEL_MAP[params.DiamondLevel.toString()],
            TransactionCountLimitMap: {
                BASIC_TRANSFER: identity.transactionSpendingLimitOptions.TransactionCountLimitMap
                    ?.BASIC_TRANSFER ??
                    options?.txLimitCount ??
                    1,
            },
        });
    }
    return handleSignAndSubmit('api/v0/send-diamonds', params, options);
};
const buildSendDiamondsConsensusKVs = (params) => {
    const consensusExtraDataKVs = [];
    const diamondLevelKV = new TransactionExtraDataKV();
    diamondLevelKV.key = encodeUTF8ToBytes('DiamondLevel');
    diamondLevelKV.value = uvarint64ToBuf(params.DiamondLevel);
    consensusExtraDataKVs.push(diamondLevelKV);
    const diamondPostHashKV = new TransactionExtraDataKV();
    diamondPostHashKV.key = encodeUTF8ToBytes('DiamondPostHash');
    diamondPostHashKV.value = hexToBytes(params.DiamondPostHashHex);
    consensusExtraDataKVs.push(diamondPostHashKV);
    return consensusExtraDataKVs;
};
// This one is a bit annoying since we should really look up how many diamonds you've already given on this post and only send the diff.
export const constructDiamondTransaction = (params) => {
    return Promise.reject('Local construction for diamonds not supported yet.');
};
export const updateLikeStatus = async (params, options) => {
    const txWithFee = getTxWithFeeNanos(params.ReaderPublicKeyBase58Check, buildLikeMetadata(params), {
        ExtraData: params.ExtraData,
        MinFeeRateNanosPerKB: params.MinFeeRateNanosPerKB,
        TransactionFees: params.TransactionFees,
    });
    if (options?.checkPermissions !== false) {
        await guardTxPermission({
            GlobalDESOLimit: txWithFee.feeNanos + sumTransactionFees(params.TransactionFees),
            TransactionCountLimitMap: {
                LIKE: options?.txLimitCount ??
                    identity.transactionSpendingLimitOptions.TransactionCountLimitMap
                        ?.LIKE ??
                    1,
            },
        });
    }
    return handleSignAndSubmit('api/v0/create-like-stateless', params, {
        ...options,
        constructionFunction: constructLikeTransaction,
    });
};
const buildLikeMetadata = (params) => {
    const metadata = new TransactionMetadataLike();
    metadata.likedPostHash = hexToBytes(params.LikedPostHashHex);
    metadata.isUnlike = !!params.IsUnlike;
    return metadata;
};
export const constructLikeTransaction = (params) => {
    return constructBalanceModelTx(params.ReaderPublicKeyBase58Check, buildLikeMetadata(params), {
        ExtraData: params.ExtraData,
        MinFeeRateNanosPerKB: params.MinFeeRateNanosPerKB,
        TransactionFees: params.TransactionFees,
    });
};
var NewMessageType;
(function (NewMessageType) {
    NewMessageType[NewMessageType["DM"] = 0] = "DM";
    NewMessageType[NewMessageType["Group"] = 1] = "Group";
})(NewMessageType || (NewMessageType = {}));
var NewMessageOperation;
(function (NewMessageOperation) {
    NewMessageOperation[NewMessageOperation["Create"] = 0] = "Create";
    NewMessageOperation[NewMessageOperation["Update"] = 1] = "Update";
})(NewMessageOperation || (NewMessageOperation = {}));
export const sendDMMessage = async (params, options) => {
    const txWithFee = getTxWithFeeNanos(params.SenderAccessGroupOwnerPublicKeyBase58Check, buildNewMessageMetadata(params, {
        type: NewMessageType.DM,
        operation: NewMessageOperation.Create,
    }), {
        ExtraData: params.ExtraData,
        MinFeeRateNanosPerKB: params.MinFeeRateNanosPerKB,
        TransactionFees: params.TransactionFees,
    });
    if (options?.checkPermissions !== false) {
        await guardTxPermission({
            GlobalDESOLimit: txWithFee.feeNanos + sumTransactionFees(params.TransactionFees),
            TransactionCountLimitMap: {
                NEW_MESSAGE: options?.txLimitCount ??
                    identity.transactionSpendingLimitOptions?.TransactionCountLimitMap
                        ?.NEW_MESSAGE ??
                    1,
            },
        });
    }
    return handleSignAndSubmit('api/v0/send-dm-message', params, {
        ...options,
        constructionFunction: constructSendDMTransaction,
    });
};
const buildNewMessageMetadata = (params, { type, operation, timestampNanos = Math.ceil(1e6 * (globalThis.performance.timeOrigin + globalThis.performance.now())), }) => {
    const metadata = new TransactionMetadataNewMessage();
    metadata.encryptedText = encodeUTF8ToBytes(params.EncryptedMessageText);
    metadata.newMessageOperation = operation;
    metadata.newMessageType = type;
    metadata.recipientAccessGroupKeyname = encodeUTF8ToBytes(params.RecipientAccessGroupKeyName);
    metadata.recipientAccessGroupOwnerPublicKey = bs58PublicKeyToCompressedBytes(params.RecipientAccessGroupOwnerPublicKeyBase58Check);
    metadata.recipientAccessGroupPublicKey = bs58PublicKeyToCompressedBytes(params.RecipientAccessGroupPublicKeyBase58Check);
    metadata.senderAccessGroupKeyName = encodeUTF8ToBytes(params.SenderAccessGroupKeyName);
    metadata.senderAccessGroupOwnerPublicKey = bs58PublicKeyToCompressedBytes(params.SenderAccessGroupOwnerPublicKeyBase58Check);
    metadata.senderAccessGroupPublicKey = bs58PublicKeyToCompressedBytes(params.SenderAccessGroupPublicKeyBase58Check);
    metadata.timestampNanos = timestampNanos;
    return metadata;
};
export const constructSendDMTransaction = (params) => {
    return constructBalanceModelTx(params.SenderAccessGroupOwnerPublicKeyBase58Check, buildNewMessageMetadata(params, {
        type: NewMessageType.DM,
        operation: NewMessageOperation.Create,
    }), {
        ExtraData: params.ExtraData,
        MinFeeRateNanosPerKB: params.MinFeeRateNanosPerKB,
        TransactionFees: params.TransactionFees,
    });
};
/**
 * https://docs.deso.org/deso-backend/construct-transactions/social-transactions-api#send-direct-message
 */
export const updateDMMessage = async (params, options) => {
    const txWithFee = getTxWithFeeNanos(params.SenderAccessGroupOwnerPublicKeyBase58Check, buildNewMessageMetadata(params, {
        type: NewMessageType.DM,
        operation: NewMessageOperation.Update,
        timestampNanos: parseInt(params.TimestampNanosString),
    }), {
        ExtraData: params.ExtraData,
        MinFeeRateNanosPerKB: params.MinFeeRateNanosPerKB,
        TransactionFees: params.TransactionFees,
    });
    if (options?.checkPermissions !== false) {
        await guardTxPermission({
            GlobalDESOLimit: txWithFee.feeNanos + sumTransactionFees(params.TransactionFees),
            TransactionCountLimitMap: {
                NEW_MESSAGE: options?.txLimitCount ??
                    identity.transactionSpendingLimitOptions?.TransactionCountLimitMap
                        ?.NEW_MESSAGE ??
                    1,
            },
        });
    }
    return handleSignAndSubmit('api/v0/update-dm-message', params, {
        ...options,
        constructionFunction: constructUpdateDMTransaction,
    });
};
export const constructUpdateDMTransaction = (params) => {
    return constructBalanceModelTx(params.SenderAccessGroupOwnerPublicKeyBase58Check, buildNewMessageMetadata(params, {
        type: NewMessageType.DM,
        operation: NewMessageOperation.Update,
        timestampNanos: parseInt(params.TimestampNanosString),
    }), {
        ExtraData: params.ExtraData,
        MinFeeRateNanosPerKB: params.MinFeeRateNanosPerKB,
        TransactionFees: params.TransactionFees,
    });
};
/**
 * https://docs.deso.org/deso-backend/construct-transactions/social-transactions-api#send-group-chat-message
 */
export const sendGroupChatMessage = async (params, options) => {
    const txWithFee = getTxWithFeeNanos(params.SenderAccessGroupOwnerPublicKeyBase58Check, buildNewMessageMetadata(params, {
        type: NewMessageType.Group,
        operation: NewMessageOperation.Create,
    }), {
        ExtraData: params.ExtraData,
        MinFeeRateNanosPerKB: params.MinFeeRateNanosPerKB,
        TransactionFees: params.TransactionFees,
    });
    if (options?.checkPermissions !== false) {
        await guardTxPermission({
            GlobalDESOLimit: txWithFee.feeNanos + sumTransactionFees(params.TransactionFees),
            TransactionCountLimitMap: {
                NEW_MESSAGE: options?.txLimitCount ??
                    identity.transactionSpendingLimitOptions?.TransactionCountLimitMap
                        ?.NEW_MESSAGE ??
                    1,
            },
        });
    }
    return handleSignAndSubmit('api/v0/send-group-chat-message', params, {
        ...options,
        constructionFunction: constructSendGroupChatMessageTransaction,
    });
};
export const constructSendGroupChatMessageTransaction = (params) => {
    return constructBalanceModelTx(params.SenderAccessGroupOwnerPublicKeyBase58Check, buildNewMessageMetadata(params, {
        type: NewMessageType.Group,
        operation: NewMessageOperation.Create,
    }), {
        ExtraData: params.ExtraData,
        MinFeeRateNanosPerKB: params.MinFeeRateNanosPerKB,
        TransactionFees: params.TransactionFees,
    });
};
export const sendMessage = async (params, options) => {
    if (!params.AccessGroup) {
        params.AccessGroup = 'default-key';
    }
    const txWithFee = getTxWithFeeNanos(params.SenderPublicKeyBase58Check, buildNewMessageMetadata({
        // NOTE: some of these fields we don't *actually* know without making an
        // api call to get them, but for the purpose of estimating the fees, we
        // can just use dummy values.
        SenderAccessGroupOwnerPublicKeyBase58Check: params.SenderPublicKeyBase58Check,
        SenderAccessGroupPublicKeyBase58Check: params.SenderPublicKeyBase58Check,
        SenderAccessGroupKeyName: params.AccessGroup,
        RecipientAccessGroupOwnerPublicKeyBase58Check: params.RecipientPublicKeyBase58Check,
        RecipientAccessGroupPublicKeyBase58Check: params.RecipientPublicKeyBase58Check,
        RecipientAccessGroupKeyName: params.AccessGroup,
        // NOTE: We are calculating the fee in order to determine whether or not
        // we should prompt the user to re-approve the derived key used for
        // signing transactions. We *must* do this before executing any async
        // code, otherwise popup blockers will generally block the popup.
        // Encrypting the message is an async operation, so we must use the
        // plain text message for the fee calculation which is not exactly
        // right, but it should be close. We may need to revisit this, however,
        // and include a buffer in the fee calculation.
        EncryptedMessageText: params.Message,
        MinFeeRateNanosPerKB: params.MinFeeRateNanosPerKB,
        TransactionFees: params.TransactionFees,
        ExtraData: params.ExtraData,
    }, {
        type: NewMessageType.Group,
        operation: NewMessageOperation.Create,
    }), {
        ExtraData: params.ExtraData,
        MinFeeRateNanosPerKB: params.MinFeeRateNanosPerKB,
        TransactionFees: params.TransactionFees,
    });
    if (options?.checkPermissions !== false) {
        await guardTxPermission({
            GlobalDESOLimit: txWithFee.feeNanos + sumTransactionFees(params.TransactionFees),
            TransactionCountLimitMap: {
                NEW_MESSAGE: options?.txLimitCount ??
                    identity.transactionSpendingLimitOptions?.TransactionCountLimitMap
                        ?.NEW_MESSAGE ??
                    1,
            },
        });
    }
    const { SenderAccessGroupPublicKeyBase58Check, SenderAccessGroupKeyName, RecipientAccessGroupPublicKeyBase58Check, RecipientAccessGroupKeyName, } = await checkPartyAccessGroups({
        SenderPublicKeyBase58Check: params.SenderPublicKeyBase58Check,
        SenderAccessGroupKeyName: 'default-key',
        RecipientPublicKeyBase58Check: params.RecipientPublicKeyBase58Check,
        RecipientAccessGroupKeyName: params.AccessGroup,
    });
    if (!SenderAccessGroupKeyName) {
        throw new Error('Sender does not have default messaging group');
    }
    const EncryptedMessageText = options?.sendMessageUnencrypted
        ? hexEncodePlainText(params.Message)
        : await identity.encryptMessage(RecipientAccessGroupPublicKeyBase58Check, params.Message);
    if (!EncryptedMessageText) {
        throw new Error('Failed to encrypt message');
    }
    const sendMessageRequestParams = {
        SenderAccessGroupOwnerPublicKeyBase58Check: params.SenderPublicKeyBase58Check,
        SenderAccessGroupPublicKeyBase58Check,
        SenderAccessGroupKeyName,
        RecipientAccessGroupOwnerPublicKeyBase58Check: params.RecipientPublicKeyBase58Check,
        RecipientAccessGroupPublicKeyBase58Check,
        RecipientAccessGroupKeyName,
        EncryptedMessageText,
        ExtraData: params.ExtraData,
        MinFeeRateNanosPerKB: params.MinFeeRateNanosPerKB,
    };
    return params.AccessGroup === 'default-key'
        ? sendDMMessage(sendMessageRequestParams, options)
        : sendGroupChatMessage(sendMessageRequestParams, options);
};
/**
 * https://docs.deso.org/deso-backend/construct-transactions/social-transactions-api#send-group-chat-message
 */
export const updateGroupChatMessage = async (params, options) => {
    const txWithFee = getTxWithFeeNanos(params.SenderAccessGroupOwnerPublicKeyBase58Check, buildNewMessageMetadata(params, {
        type: NewMessageType.Group,
        operation: NewMessageOperation.Update,
        timestampNanos: parseInt(params.TimestampNanosString),
    }), {
        ExtraData: params.ExtraData,
        MinFeeRateNanosPerKB: params.MinFeeRateNanosPerKB,
        TransactionFees: params.TransactionFees,
    });
    if (options?.checkPermissions !== false) {
        await guardTxPermission({
            GlobalDESOLimit: txWithFee.feeNanos + sumTransactionFees(params.TransactionFees),
            TransactionCountLimitMap: {
                NEW_MESSAGE: options?.txLimitCount ??
                    identity.transactionSpendingLimitOptions?.TransactionCountLimitMap
                        ?.NEW_MESSAGE ??
                    1,
            },
        });
    }
    return handleSignAndSubmit('api/v0/update-group-chat-message', params, {
        ...options,
        constructionFunction: constructUpdateGroupChatMessageTransaction,
    });
};
export const constructUpdateGroupChatMessageTransaction = (params) => {
    return constructBalanceModelTx(params.SenderAccessGroupOwnerPublicKeyBase58Check, buildNewMessageMetadata(params, {
        type: NewMessageType.Group,
        operation: NewMessageOperation.Update,
        timestampNanos: parseInt(params.TimestampNanosString),
    }), {
        ExtraData: params.ExtraData,
        MinFeeRateNanosPerKB: params.MinFeeRateNanosPerKB,
        TransactionFees: params.TransactionFees,
    });
};
/**
 * @private
 * internal helper function to convert a string to hex
 * @param plainText
 * @returns hex encoded string
 */
function hexEncodePlainText(plainText) {
    const textEncoder = new TextEncoder();
    const bytes = textEncoder.encode(plainText);
    return ecUtils.bytesToHex(new Uint8Array(bytes));
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29jaWFsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL3RyYW5zYWN0aW9ucy9zb2NpYWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ2pELE9BQU8sRUFBRSxLQUFLLElBQUksT0FBTyxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFtQnBELE9BQU8sRUFFTCxzQkFBc0IsR0FDdkIsTUFBTSxrQkFBa0IsQ0FBQztBQUMxQixPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUM3RCxPQUFPLEVBQ0wsc0JBQXNCLEVBQ3RCLGdDQUFnQyxFQUNoQyx5QkFBeUIsRUFDekIsdUJBQXVCLEVBQ3ZCLDZCQUE2QixFQUM3Qiw2QkFBNkIsRUFDN0IsZ0NBQWdDLEVBQ2hDLDhCQUE4QixFQUM5QixpQkFBaUIsRUFDakIsUUFBUSxFQUNSLGNBQWMsR0FDZixNQUFNLHNCQUFzQixDQUFDO0FBQzlCLE9BQU8sRUFDTCx1QkFBdUIsRUFDdkIsaUJBQWlCLEVBQ2pCLG1CQUFtQixFQUNuQixrQkFBa0IsR0FDbkIsTUFBTSxnQkFBZ0IsQ0FBQztBQU14QixPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFFL0MsTUFBTSwwQkFBMEIsR0FBRyxDQUFDLE1BQWtDLEVBQUUsRUFBRTtJQUN4RSxNQUFNLFFBQVEsR0FBRyxJQUFJLGdDQUFnQyxFQUFFLENBQUM7SUFDeEQsd0JBQXdCO0lBQ3hCLFFBQVEsQ0FBQyxnQkFBZ0I7UUFDdkIsTUFBTSxDQUFDLDJCQUEyQixLQUFLLE1BQU0sQ0FBQywyQkFBMkI7WUFDdkUsQ0FBQyxDQUFDLDhCQUE4QixDQUFDLE1BQU0sQ0FBQywyQkFBMkIsQ0FBQztZQUNwRSxDQUFDLENBQUMsSUFBSSxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDeEIsUUFBUSxDQUFDLFdBQVcsR0FBRyxpQkFB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QUcsSUFBSSxXQUFXLEVBQUUsQ0FBQztJQUN0QyxNQUFNLEtBQUssR0FBRyxXQUFXLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQzVDLE9BQU8sT0FBTyxDQUFDLFVBQVUsQ0FBQyxJQUFJLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO0FBQ25ELENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBoZXhUb0J5dGVzIH0gZnJvbSAnQG5vYmxlL2hhc2hlcy91dGlscyc7XG5pbXBvcnQgeyB1dGlscyBhcyBlY1V0aWxzIH0gZnJvbSAnQG5vYmxlL3NlY3AyNTZrMSc7XG5pbXBvcnQge1xuICBDb25zdHJ1Y3RlZFRyYW5zYWN0aW9uUmVzcG9uc2UsXG4gIENyZWF0ZUZvbGxvd1R4blN0YXRlbGVzc1JlcXVlc3QsXG4gIENyZWF0ZUZvbGxvd1R4blN0YXRlbGVzc1Jlc3BvbnNlLFxuICBDcmVhdGVMaWtlU3RhdGVsZXNzUmVxdWVzdCxcbiAgQ3JlYXRlTGlrZVN0YXRlbGVzc1Jlc3BvbnNlLFxuICBEZVNvQm9keVNjaGVtYSxcbiAgRGlhbW9uZExldmVsU3RyaW5nLFxuICBTZW5kRGlhbW9uZHNSZXF1ZXN0LFxuICBTZW5kRGlhbW9uZHNSZXNwb25zZSxcbiAgU2VuZE5ld01lc3NhZ2VSZXF1ZXN0LFxuICBTZW5kTmV3TWVzc2FnZVJlc3BvbnNlLFxuICBTdWJtaXRQb3N0UmVxdWVzdCxcbiAgU3VibWl0UG9zdFJlc3BvbnNlLFxuICBUcmFuc2FjdGlvbkZlZSxcbiAgVXBkYXRlUHJvZmlsZVJlcXVlc3QsXG4gIFVwZGF0ZVByb2ZpbGVSZXNwb25zZSxcbn0gZnJvbSAnLi4vYmFja2VuZC10eXBlcy9pbmRleC5qcyc7XG5pbXBvcnQge1xuICBQYXJ0aWFsV2l0aFJlcXVpcmVkRmllbGRzLFxuICBjaGVja1BhcnR5QWNjZXNzR3JvdXBzLFxufSBmcm9tICcuLi9kYXRhL2luZGV4LmpzJztcbmltcG9ydCB7IERJQU1PTkRfTEVWRUxfTUFQIH0gZnJvbSAnLi4vaWRlbnRpdHkvY29uc3RhbnRzLmpzJztcbmltcG9ydCB7XG4gIFRyYW5zYWN0aW9uRXh0cmFEYXRhS1YsXG4gIFRyYW5zYWN0aW9uTWV0YWRhdGFCYXNpY1RyYW5zZmVyLFxuICBUcmFuc2FjdGlvbk1ldGFkYXRhRm9sbG93LFxuICBUcmFuc2FjdGlvbk1ldGFkYXRhTGlrZSxcbiAgVHJhbnNhY3Rpb25NZXRhZGF0YU5ld01lc3NhZ2UsXG4gIFRyYW5zYWN0aW9uTWV0YWRhdGFTdWJtaXRQb3N0LFxuICBUcmFuc2FjdGlvbk1ldGFkYXRhVXBkYXRlUHJvZmlsZSxcbiAgYnM1OFB1YmxpY0tleVRvQ29tcHJlc3NlZEJ5dGVzLFxuICBlbmNvZGVVVEY4VG9CeXRlcyxcbiAgaWRlbnRpdHksXG4gIHV2YXJpbnQ2NFRvQnVmLFxufSBmcm9tICcuLi9pZGVudGl0eS9pbmRleC5qcyc7XG5pbXBvcnQge1xuICBjb25zdHJ1Y3RCYWxhbmNlTW9kZWxUeCxcbiAgZ2V0VHhXaXRoRmVlTmFub3MsXG4gIGhhbmRsZVNpZ25BbmRTdWJtaXQsXG4gIHN1bVRyYW5zYWN0aW9uRmVlcyxcbn0gZnJvbSAnLi4vaW50ZXJuYWwuanMnO1xuaW1wb3J0IHtcbiAgQ29uc3RydWN0ZWRBbmRTdWJtaXR0ZWRUeCxcbiAgVHhSZXF1ZXN0T3B0aW9ucyxcbiAgVHlwZVdpdGhPcHRpb25hbEZlZXNBbmRFeHRyYURhdGEsXG59IGZyb20gJy4uL3R5cGVzLmpzJztcbmltcG9ydCB7IGd1YXJkVHhQZXJtaXNzaW9uIH0gZnJvbSAnLi91dGlscy5qcyc7XG5cbmNvbnN0IGJ1aWxkVXBkYXRlUHJvZmlsZU1ldGFkYXRhID0gKHBhcmFtczogVXBkYXRlUHJvZmlsZVJlcXVlc3RQYXJhbXMpID0+IHtcbiAgY29uc3QgbWV0YWRhdGEgPSBuZXcgVHJhbnNhY3Rpb25NZXRhZGF0YVVwZGF0ZVByb2ZpbGUoKTtcbiAgLy8gVE9ETzogdGhpcyBpcyBicm9rZW4uXG4gIG1ldGFkYXRhLnByb2ZpbGVQdWJsaWNLZXkgPVxuICAgIHBhcmFtcy5VcGRhdGVyUHVibGljS2V5QmFzZTU4Q2hlY2sgIT09IHBhcmFtcy5Qcm9maWxlUHVibGljS2V5QmFzZTU4Q2hlY2tcbiAgICAgID8gYnM1OFB1YmxpY0tleVRvQ29tcHJlc3NlZEJ5dGVzKHBhcmFtcy5Qcm9maWxlUHVibGljS2V5QmFzZTU4Q2hlY2spXG4gICAgICA6IG5ldyBVaW50OEFycmF5KDApO1xuICBtZXRhZGF0YS5uZXdVc2VybmFtZSA9IGVuY29kZVVURjhUb0J5dGVzKHBhcmFtcy5OZXdVc2VybmFtZSA/PyAnJyk7XG4gIG1ldGFkYXRhLm5ld0Rlc2NyaXB0aW9uID0gZW5jb2RlVVRGOFRvQnl0ZXMocGFyYW1zLk5ld0Rlc2NyaXB0aW9uID8/ICcnKTtcbiAgLy8gVE9ETzogd2UgcHJvYmFibHkgbmVlZCBzb21ldGhpbmcgdG8gaGFuZGxlIHRoZSBwcm9maWxlIHBpYyBjb21wcmVzc2lvbiBoZXJlLlxuICBtZXRhZGF0YS5uZXdQcm9maWxlUGljID0gZW5jb2RlVVRGOFRvQnl0ZXMocGFyYW1zLk5ld1Byb2ZpbGVQaWMgPz8gJycpO1xuICBtZXRhZGF0YS5uZXdDcmVhdG9yQmFzaXNQb2ludHMgPSBwYXJhbXMuTmV3Q3JlYXRvckJhc2lzUG9pbnRzO1xuICBtZXRhZGF0YS5uZXdTdGFrZU11bHRpcGxlQmFzaXNQb2ludHMgPSBwYXJhbXMuTmV3U3Rha2VNdWx0aXBsZUJhc2lzUG9pbnRzO1xuICBtZXRhZGF0YS5pc0hpZGRlbiA9IHBhcmFtcy5Jc0hpZGRlbiA/PyBmYWxzZTtcblxuICByZXR1cm4gbWV0YWRhdGE7XG59O1xuXG5leHBvcnQgY29uc3QgY29uc3RydWN0VXBkYXRlUHJvZmlsZVRyYW5zYWN0aW9uID0gKFxuICBwYXJhbXM6IFR5cGVXaXRoT3B0aW9uYWxGZWVzQW5kRXh0cmFEYXRhPFVwZGF0ZVByb2ZpbGVSZXF1ZXN0PlxuKTogUHJvbWlzZTxDb25zdHJ1Y3RlZFRyYW5zYWN0aW9uUmVzcG9uc2U+ID0+IHtcbiAgcmV0dXJuIGNvbnN0cnVjdEJhbGFuY2VNb2RlbFR4KFxuICAgIHBhcmFtcy5VcGRhdGVyUHVibGljS2V5QmFzZTU4Q2hlY2ssXG4gICAgYnVpbGRVcGRhdGVQcm9maWxlTWV0YWRhdGEocGFyYW1zKSxcbiAgICB7XG4gICAgICBFeHRyYURhdGE6IHBhcmFtcy5FeHRyYURhdGEsXG4gICAgICBNaW5GZWVSYXRlTmFub3NQZXJLQjogcGFyYW1zLk1pbkZlZVJhdGVOYW5vc1BlcktCLFxuICAgICAgVHJhbnNhY3Rpb25GZWVzOiBwYXJhbXMuVHJhbnNhY3Rpb25GZWVzLFxuICAgIH1cbiAgKTtcbn07XG5cbnR5cGUgVXBkYXRlUHJvZmlsZVJlcXVlc3RQYXJhbXMgPSBUeXBlV2l0aE9wdGlvbmFsRmVlc0FuZEV4dHJhRGF0YTxcbiAgUGFydGlhbFdpdGhSZXF1aXJlZEZpZWxkczxcbiAgICBVcGRhdGVQcm9maWxlUmVxdWVzdCxcbiAgICB8ICdVcGRhdGVyUHVibGljS2V5QmFzZTU4Q2hlY2snXG4gICAgfCAnUHJvZmlsZVB1YmxpY0tleUJhc2U1OENoZWNrJ1xuICAgIHwgJ05ld0NyZWF0b3JCYXNpc1BvaW50cydcbiAgICB8ICdOZXdTdGFrZU11bHRpcGxlQmFzaXNQb2ludHMnXG4gID5cbj47XG4vKipcbiAqIGh0dHBzOi8vZG9jcy5kZXNvLm9yZy9kZXNvLWJhY2tlbmQvY29uc3RydWN0LXRyYW5zYWN0aW9ucy9zb2NpYWwtdHJhbnNhY3Rpb25zLWFwaSN1cGRhdGUtcHJvZmlsZVxuICovXG5leHBvcnQgY29uc3QgdXBkYXRlUHJvZmlsZSA9IGFzeW5jIChcbiAgcGFyYW1zOiBVcGRhdGVQcm9maWxlUmVxdWVzdFBhcmFtcyxcbiAgb3B0aW9ucz86IFR4UmVxdWVzdE9wdGlvbnNcbik6IFByb21pc2U8XG4gIENvbnN0cnVjdGVkQW5kU3VibWl0dGVkVHg8XG4gICAgVXBkYXRlUHJvZmlsZVJlc3BvbnNlIHwgQ29uc3RydWN0ZWRUcmFuc2FjdGlvblJlc3BvbnNlXG4gID5cbj4gPT4ge1xuICBjb25zdCB0eFdpdGhGZWUgPSBnZXRUeFdpdGhGZWVOYW5vcyhcbiAgICBwYXJhbXMuVXBkYXRlclB1YmxpY0tleUJhc2U1OENoZWNrLFxuICAgIGJ1aWxkVXBkYXRlUHJvZmlsZU1ldGFkYXRhKHBhcmFtcyksXG4gICAge1xuICAgICAgRXh0cmFEYXRhOiBwYXJhbXMuRXh0cmFEYXRhLFxuICAgICAgTWluRmVlUmF0ZU5hbm9zUGVyS0I6IHBhcmFtcy5NaW5GZWVSYXRlTmFub3NQZXJLQixcbiAgICAgIFRyYW5zYWN0aW9uRmVlczogcGFyYW1zLlRyYW5zYWN0aW9uRmVlcyxcbiAgICB9XG4gICk7XG5cbiAgaWYgKG9wdGlvbnM/LmNoZWNrUGVybWlzc2lvbnMgIT09IGZhbHNlKSB7XG4gICAgYXdhaXQgZ3VhcmRUeFBlcm1pc3Npb24oe1xuICAgICAgR2xvYmFsREVTT0xpbWl0OlxuICAgICAgICB0eFdpdGhGZWUuZmVlTmFub3MgKyBzdW1UcmFuc2FjdGlvbkZlZXMocGFyYW1zLlRyYW5zYWN0aW9uRmVlcyksXG4gICAgICBUcmFuc2FjdGlvbkNvdW50TGltaXRNYXA6IHtcbiAgICAgICAgVVBEQVRFX1BST0ZJTEU6XG4gICAgICAgICAgb3B0aW9ucz8udHhMaW1pdENvdW50ID8/XG4gICAgICAgICAgaWRlbnRpdHkudHJhbnNhY3Rpb25TcGVuZGluZ0xpbWl0T3B0aW9ucz8uVHJhbnNhY3Rpb25Db3VudExpbWl0TWFwXG4gICAgICAgICAgICA/LlVQREFURV9QUk9GSUxFID8/XG4gICAgICAgICAgMSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4gaGFuZGxlU2lnbkFuZFN1Ym1pdCgnYXBpL3YwL3VwZGF0ZS1wcm9maWxlJywgcGFyYW1zLCB7XG4gICAgLi4ub3B0aW9ucyxcbiAgICBjb25zdHJ1Y3Rpb25GdW5jdGlvbjogY29uc3RydWN0VXBkYXRlUHJvZmlsZVRyYW5zYWN0aW9uLFxuICB9KTtcbn07XG5cbmNvbnN0IGJ1aWxkU3VibWl0UG9zdE1ldGFkYXRhID0gKHBhcmFtczogU3VibWl0UG9zdFJlcXVlc3RQYXJhbXMpID0+IHtcbiAgY29uc3QgbWV0YWRhdGEgPSBuZXcgVHJhbnNhY3Rpb25NZXRhZGF0YVN1Ym1pdFBvc3QoKTtcbiAgY29uc3QgQm9keU9iakNvcHk6IFBhcnRpYWw8RGVTb0JvZHlTY2hlbWE+ID0ge307XG4gIE9iamVjdC5rZXlzKHBhcmFtcy5Cb2R5T2JqKS5mb3JFYWNoKChrKSA9PiB7XG4gICAgY29uc3Qga2V5ID0gayBhcyBrZXlvZiBEZVNvQm9keVNjaGVtYTtcbiAgICBjb25zdCB2YWx1ZSA9IHBhcmFtcy5Cb2R5T2JqW2tleV0gYXMgc3RyaW5nICYgc3RyaW5nW107XG4gICAgaWYgKCF2YWx1ZSkgcmV0dXJuO1xuICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSAmJiB2YWx1ZS5sZW5ndGggPiAwKSB7XG4gICAgICBCb2R5T2JqQ29weVtrZXldID0gdmFsdWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIEJvZHlPYmpDb3B5W2tleV0gPSB2YWx1ZTtcbiAgICB9XG4gIH0pO1xuICBtZXRhZGF0YS5ib2R5ID0gZW5jb2RlVVRGOFRvQnl0ZXMoSlNPTi5zdHJpbmdpZnkoQm9keU9iakNvcHkpKTtcbiAgbWV0YWRhdGEuY3JlYXRvckJhc2lzUG9pbnRzID0gMTAwMDtcbiAgbWV0YWRhdGEuc3Rha2VNdWx0aXBsZUJhc2lzUG9pbnRzID0gMTI1MDA7XG4gIG1ldGFkYXRhLnRpbWVzdGFtcE5hbm9zID0gTWF0aC5jZWlsKFxuICAgIDFlNiAqIChnbG9iYWxUaGlzLnBlcmZvcm1hbmNlLnRpbWVPcmlnaW4gKyBnbG9iYWxUaGlzLnBlcmZvcm1hbmNlLm5vdygpKVxuICApO1xuICBtZXRhZGF0YS5pc0hpZGRlbiA9ICEhcGFyYW1zLklzSGlkZGVuO1xuICBtZXRhZGF0YS5wYXJlbnRTdGFrZUlkID0gaGV4VG9CeXRlcyhwYXJhbXMuUGFyZW50U3Rha2VJRCB8fCAnJyk7XG4gIG1ldGFkYXRhLnBvc3RIYXNoVG9Nb2RpZnkgPSBoZXhUb0J5dGVzKHBhcmFtcy5Qb3N0SGFzaEhleFRvTW9kaWZ5IHx8ICcnKTtcblxuICByZXR1cm4gbWV0YWRhdGE7XG59O1xuXG5jb25zdCBidWlsZFN1Ym1pdFBvc3RDb25zZW5zdXNLVnMgPSAocGFyYW1zOiBTdWJtaXRQb3N0UmVxdWVzdFBhcmFtcykgPT4ge1xuICBjb25zdCBleHRyYURhdGFLVnM6IFRyYW5zYWN0aW9uRXh0cmFEYXRhS1ZbXSA9IFtdO1xuXG4gIGlmIChwYXJhbXMuUmVwb3N0ZWRQb3N0SGFzaEhleCkge1xuICAgIGV4dHJhRGF0YUtWcy5wdXNoKFxuICAgICAgbmV3IFRyYW5zYWN0aW9uRXh0cmFEYXRhS1YoXG4gICAgICAgIGVuY29kZVVURjhUb0J5dGVzKCdSZWNsb3V0ZWRQb3N0SGFzaCcpLFxuICAgICAgICBoZXhUb0J5dGVzKHBhcmFtcy5SZXBvc3RlZFBvc3RIYXNoSGV4KVxuICAgICAgKVxuICAgICk7XG4gICAgZXh0cmFEYXRhS1ZzLnB1c2goXG4gICAgICBuZXcgVHJhbnNhY3Rpb25FeHRyYURhdGFLVihcbiAgICAgICAgZW5jb2RlVVRGOFRvQnl0ZXMoJ0lzUXVvdGVkUmVjbG91dCcpLFxuICAgICAgICBVaW50OEFycmF5LmZyb20oW1xuICAgICAgICAgICFwYXJhbXMuQm9keU9iai5Cb2R5ICYmXG4gICAgICAgICAgIXBhcmFtcy5Cb2R5T2JqLkltYWdlVVJMcz8ubGVuZ3RoICYmXG4gICAgICAgICAgIXBhcmFtcy5Cb2R5T2JqLlZpZGVvVVJMcz8ubGVuZ3RoXG4gICAgICAgICAgICA/IDBcbiAgICAgICAgICAgIDogMSxcbiAgICAgICAgXSlcbiAgICAgIClcbiAgICApO1xuICB9XG5cbiAgcmV0dXJuIGV4dHJhRGF0YUtWcztcbn07XG5cbmV4cG9ydCBjb25zdCBjb25zdHJ1Y3RTdWJtaXRQb3N0ID0gKFxuICBwYXJhbXM6IFN1Ym1pdFBvc3RSZXF1ZXN0UGFyYW1zXG4pOiBQcm9taXNlPENvbnN0cnVjdGVkVHJhbnNhY3Rpb25SZXNwb25zZT4gPT4ge1xuICByZXR1cm4gY29uc3RydWN0QmFsYW5jZU1vZGVsVHgoXG4gICAgcGFyYW1zLlVwZGF0ZXJQdWJsaWNLZXlCYXNlNThDaGVjayxcbiAgICBidWlsZFN1Ym1pdFBvc3RNZXRhZGF0YShwYXJhbXMpLFxuICAgIHtcbiAgICAgIEV4dHJhRGF0YTogcGFyYW1zLkV4dHJhRGF0YSxcbiAgICAgIENvbnNlbnN1c0V4dHJhRGF0YUtWczogYnVpbGRTdWJtaXRQb3N0Q29uc2Vuc3VzS1ZzKHBhcmFtcyksXG4gICAgICBNaW5GZWVSYXRlTmFub3NQZXJLQjogcGFyYW1zLk1pbkZlZVJhdGVOYW5vc1BlcktCLFxuICAgICAgVHJhbnNhY3Rpb25GZWVzOiBwYXJhbXMuVHJhbnNhY3Rpb25GZWVzLFxuICAgIH1cbiAgKTtcbn07XG5cbi8qKlxuICogaHR0cHM6Ly9kb2NzLmRlc28ub3JnL2Rlc28tYmFja2VuZC9jb25zdHJ1Y3QtdHJhbnNhY3Rpb25zL3NvY2lhbC10cmFuc2FjdGlvbnMtYXBpI3N1Ym1pdC1wb3N0XG4gKi9cbmV4cG9ydCB0eXBlIFN1Ym1pdFBvc3RSZXF1ZXN0UGFyYW1zID0gVHlwZVdpdGhPcHRpb25hbEZlZXNBbmRFeHRyYURhdGE8XG4gIFBhcnRpYWxXaXRoUmVxdWlyZWRGaWVsZHM8XG4gICAgU3VibWl0UG9zdFJlcXVlc3QsXG4gICAgJ1VwZGF0ZXJQdWJsaWNLZXlCYXNlNThDaGVjaycgfCAnQm9keU9iaidcbiAgPlxuPjtcbmV4cG9ydCBjb25zdCBzdWJtaXRQb3N0ID0gYXN5bmMgKFxuICBwYXJhbXM6IFN1Ym1pdFBvc3RSZXF1ZXN0UGFyYW1zLFxuICBvcHRpb25zPzogVHhSZXF1ZXN0T3B0aW9uc1xuKTogUHJvbWlzZTxcbiAgQ29uc3RydWN0ZWRBbmRTdWJtaXR0ZWRUeDxTdWJtaXRQb3N0UmVzcG9uc2UgfCBDb25zdHJ1Y3RlZFRyYW5zYWN0aW9uUmVzcG9uc2U+XG4+ID0+IHtcbiAgY29uc3QgdHhXaXRoRmVlID0gZ2V0VHhXaXRoRmVlTmFub3MoXG4gICAgcGFyYW1zLlVwZGF0ZXJQdWJsaWNLZXlCYXNlNThDaGVjayxcbiAgICBidWlsZFN1Ym1pdFBvc3RNZXRhZGF0YShwYXJhbXMpLFxuICAgIHtcbiAgICAgIEV4dHJhRGF0YTogcGFyYW1zLkV4dHJhRGF0YSxcbiAgICAgIENvbnNlbnN1c0V4dHJhRGF0YUtWczogYnVpbGRTdWJtaXRQb3N0Q29uc2Vuc3VzS1ZzKHBhcmFtcyksXG4gICAgICBNaW5GZWVSYXRlTmFub3NQZXJLQjogcGFyYW1zLk1pbkZlZVJhdGVOYW5vc1BlcktCLFxuICAgICAgVHJhbnNhY3Rpb25GZWVzOiBwYXJhbXMuVHJhbnNhY3Rpb25GZWVzLFxuICAgIH1cbiAgKTtcblxuICBpZiAob3B0aW9ucz8uY2hlY2tQZXJtaXNzaW9ucyAhPT0gZmFsc2UpIHtcbiAgICBhd2FpdCBndWFyZFR4UGVybWlzc2lvbih7XG4gICAgICBHbG9iYWxERVNPTGltaXQ6XG4gICAgICAgIHR4V2l0aEZlZS5mZWVOYW5vcyArIHN1bVRyYW5zYWN0aW9uRmVlcyhwYXJhbXMuVHJhbnNhY3Rpb25GZWVzKSxcbiAgICAgIFRyYW5zYWN0aW9uQ291bnRMaW1pdE1hcDoge1xuICAgICAgICBTVUJNSVRfUE9TVDpcbiAgICAgICAgICBvcHRpb25zPy50eExpbWl0Q291bnQgPz9cbiAgICAgICAgICBpZGVudGl0eS50cmFuc2FjdGlvblNwZW5kaW5nTGltaXRPcHRpb25zPy5UcmFuc2FjdGlvbkNvdW50TGltaXRNYXBcbiAgICAgICAgICAgID8uU1VCTUlUX1BPU1QgPz9cbiAgICAgICAgICAxLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIHJldHVybiBoYW5kbGVTaWduQW5kU3VibWl0KCdhcGkvdjAvc3VibWl0LXBvc3QnLCBwYXJhbXMsIHtcbiAgICAuLi5vcHRpb25zLFxuICAgIGNvbnN0cnVjdGlvbkZ1bmN0aW9uOiBjb25zdHJ1Y3RTdWJtaXRQb3N0LFxuICB9KTtcbn07XG5cbi8qKlxuICogaHR0cHM6Ly9kb2NzLmRlc28ub3JnL2Rlc28tYmFja2VuZC9jb25zdHJ1Y3QtdHJhbnNhY3Rpb25zL3NvY2lhbC10cmFuc2FjdGlvbnMtYXBpI2ZvbGxvd1xuICovXG5leHBvcnQgdHlwZSBDcmVhdGVGb2xsb3dUeG5SZXF1ZXN0UGFyYW1zID0gVHlwZVdpdGhPcHRpb25hbEZlZXNBbmRFeHRyYURhdGE8XG4gIFBhcnRpYWxXaXRoUmVxdWlyZWRGaWVsZHM8XG4gICAgQ3JlYXRlRm9sbG93VHhuU3RhdGVsZXNzUmVxdWVzdCxcbiAgICAnRm9sbG93ZWRQdWJsaWNLZXlCYXNlNThDaGVjaycgfCAnRm9sbG93ZXJQdWJsaWNLZXlCYXNlNThDaGVjaydcbiAgPlxuPjtcblxuZXhwb3J0IGNvbnN0IHVwZGF0ZUZvbGxvd2luZ1N0YXR1cyA9IGFzeW5jIChcbiAgcGFyYW1zOiBDcmVhdGVGb2xsb3dUeG5SZXF1ZXN0UGFyYW1zLFxuICBvcHRpb25zPzogVHhSZXF1ZXN0T3B0aW9uc1xuKTogUHJvbWlzZTxDb25zdHJ1Y3RlZEFuZFN1Ym1pdHRlZFR4PENyZWF0ZUZvbGxvd1R4blN0YXRlbGVzc1Jlc3BvbnNlPj4gPT4ge1xuICBjb25zdCB0eFdpdGhGZWUgPSBnZXRUeFdpdGhGZWVOYW5vcyhcbiAgICBwYXJhbXMuRm9sbG93ZXJQdWJsaWNLZXlCYXNlNThDaGVjayxcbiAgICBidWlsZEZvbGxvd01ldGFkYXRhKHBhcmFtcyksXG4gICAge1xuICAgICAgRXh0cmFEYXRhOiBwYXJhbXMuRXh0cmFEYXRhLFxuICAgICAgTWluRmVlUmF0ZU5hbm9zUGVyS0I6IHBhcmFtcy5NaW5GZWVSYXRlTmFub3NQZXJLQixcbiAgICAgIFRyYW5zYWN0aW9uRmVlczogcGFyYW1zLlRyYW5zYWN0aW9uRmVlcyxcbiAgICB9XG4gICk7XG5cbiAgaWYgKG9wdGlvbnM/LmNoZWNrUGVybWlzc2lvbnMgIT09IGZhbHNlKSB7XG4gICAgYXdhaXQgZ3VhcmRUeFBlcm1pc3Npb24oe1xuICAgICAgR2xvYmFsREVTT0xpbWl0OlxuICAgICAgICB0eFdpdGhGZWUuZmVlTmFub3MgKyBzdW1UcmFuc2FjdGlvbkZlZXMocGFyYW1zLlRyYW5zYWN0aW9uRmVlcyksXG4gICAgICBUcmFuc2FjdGlvbkNvdW50TGltaXRNYXA6IHtcbiAgICAgICAgRk9MTE9XOlxuICAgICAgICAgIG9wdGlvbnM/LnR4TGltaXRDb3VudCA/P1xuICAgICAgICAgIGlkZW50aXR5LnRyYW5zYWN0aW9uU3BlbmRpbmdMaW1pdE9wdGlvbnM/LlRyYW5zYWN0aW9uQ291bnRMaW1pdE1hcFxuICAgICAgICAgICAgPy5GT0xMT1cgPz9cbiAgICAgICAgICAxLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIHJldHVybiBoYW5kbGVTaWduQW5kU3VibWl0KCdhcGkvdjAvY3JlYXRlLWZvbGxvdy10eG4tc3RhdGVsZXNzJywgcGFyYW1zLCB7XG4gICAgLi4ub3B0aW9ucyxcbiAgICBjb25zdHJ1Y3Rpb25GdW5jdGlvbjogY29uc3RydWN0Rm9sbG93VHJhbnNhY3Rpb24sXG4gIH0pO1xufTtcblxuY29uc3QgYnVpbGRGb2xsb3dNZXRhZGF0YSA9IChwYXJhbXM6IENyZWF0ZUZvbGxvd1R4blJlcXVlc3RQYXJhbXMpID0+IHtcbiAgY29uc3QgbWV0YWRhdGEgPSBuZXcgVHJhbnNhY3Rpb25NZXRhZGF0YUZvbGxvdygpO1xuICBtZXRhZGF0YS5mb2xsb3dlZFB1YmxpY0tleSA9IGJzNThQdWJsaWNLZXlUb0NvbXByZXNzZWRCeXRlcyhcbiAgICBwYXJhbXMuRm9sbG93ZWRQdWJsaWNLZXlCYXNlNThDaGVja1xuICApO1xuICBtZXRhZGF0YS5pc1VuZm9sbG93ID0gISFwYXJhbXMuSXNVbmZvbGxvdztcbiAgcmV0dXJuIG1ldGFkYXRhO1xufTtcblxuZXhwb3J0IGNvbnN0IGNvbnN0cnVjdEZvbGxvd1RyYW5zYWN0aW9uID0gKFxuICBwYXJhbXM6IENyZWF0ZUZvbGxvd1R4blJlcXVlc3RQYXJhbXNcbik6IFByb21pc2U8Q29uc3RydWN0ZWRUcmFuc2FjdGlvblJlc3BvbnNlPiA9PiB7XG4gIHJldHVybiBjb25zdHJ1Y3RCYWxhbmNlTW9kZWxUeChcbiAgICBwYXJhbXMuRm9sbG93ZXJQdWJsaWNLZXlCYXNlNThDaGVjayxcbiAgICBidWlsZEZvbGxvd01ldGFkYXRhKHBhcmFtcyksXG4gICAge1xuICAgICAgRXh0cmFEYXRhOiBwYXJhbXMuRXh0cmFEYXRhLFxuICAgICAgTWluRmVlUmF0ZU5hbm9zUGVyS0I6IHBhcmFtcy5NaW5GZWVSYXRlTmFub3NQZXJLQixcbiAgICAgIFRyYW5zYWN0aW9uRmVlczogcGFyYW1zLlRyYW5zYWN0aW9uRmVlcyxcbiAgICB9XG4gICk7XG59O1xuXG4vKipcbiAqIGh0dHBzOi8vZG9jcy5kZXNvLm9yZy9kZXNvLWJhY2tlbmQvY29uc3RydWN0LXRyYW5zYWN0aW9ucy9zb2NpYWwtdHJhbnNhY3Rpb25zLWFwaSNzZW5kLWRpYW1vbmRzXG4gKi9cbmV4cG9ydCBjb25zdCBzZW5kRGlhbW9uZHMgPSBhc3luYyAoXG4gIHBhcmFtczogVHlwZVdpdGhPcHRpb25hbEZlZXNBbmRFeHRyYURhdGE8U2VuZERpYW1vbmRzUmVxdWVzdD4sXG4gIG9wdGlvbnM/OiBUeFJlcXVlc3RPcHRpb25zXG4pOiBQcm9taXNlPENvbnN0cnVjdGVkQW5kU3VibWl0dGVkVHg8U2VuZERpYW1vbmRzUmVzcG9uc2U+PiA9PiB7XG4gIGNvbnN0IHR4V2l0aEZlZSA9IGdldFR4V2l0aEZlZU5hbm9zKFxuICAgIHBhcmFtcy5TZW5kZXJQdWJsaWNLZXlCYXNlNThDaGVjayxcbiAgICBuZXcgVHJhbnNhY3Rpb25NZXRhZGF0YUJhc2ljVHJhbnNmZXIoKSxcbiAgICB7XG4gICAgICBFeHRyYURhdGE6IHBhcmFtcy5FeHRyYURhdGEsXG4gICAgICBNaW5GZWVSYXRlTmFub3NQZXJLQjogcGFyYW1zLk1pbkZlZVJhdGVOYW5vc1BlcktCLFxuICAgICAgVHJhbnNhY3Rpb25GZWVzOiBwYXJhbXMuVHJhbnNhY3Rpb25GZWVzLFxuICAgICAgQ29uc2Vuc3VzRXh0cmFEYXRhS1ZzOiBidWlsZFNlbmREaWFtb25kc0NvbnNlbnN1c0tWcyhwYXJhbXMpLFxuICAgIH1cbiAgKTtcblxuICBpZiAob3B0aW9ucz8uY2hlY2tQZXJtaXNzaW9ucyAhPT0gZmFsc2UpIHtcbiAgICBhd2FpdCBndWFyZFR4UGVybWlzc2lvbih7XG4gICAgICBHbG9iYWxERVNPTGltaXQ6XG4gICAgICAgIHR4V2l0aEZlZS5mZWVOYW5vcyArXG4gICAgICAgIHN1bVRyYW5zYWN0aW9uRmVlcyhwYXJhbXMuVHJhbnNhY3Rpb25GZWVzKSArXG4gICAgICAgIERJQU1PTkRfTEVWRUxfTUFQW3BhcmFtcy5EaWFtb25kTGV2ZWwudG9TdHJpbmcoKSBhcyBEaWFtb25kTGV2ZWxTdHJpbmddLFxuICAgICAgVHJhbnNhY3Rpb25Db3VudExpbWl0TWFwOiB7XG4gICAgICAgIEJBU0lDX1RSQU5TRkVSOlxuICAgICAgICAgIGlkZW50aXR5LnRyYW5zYWN0aW9uU3BlbmRpbmdMaW1pdE9wdGlvbnMuVHJhbnNhY3Rpb25Db3VudExpbWl0TWFwXG4gICAgICAgICAgICA/LkJBU0lDX1RSQU5TRkVSID8/XG4gICAgICAgICAgb3B0aW9ucz8udHhMaW1pdENvdW50ID8/XG4gICAgICAgICAgMSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4gaGFuZGxlU2lnbkFuZFN1Ym1pdCgnYXBpL3YwL3NlbmQtZGlhbW9uZHMnLCBwYXJhbXMsIG9wdGlvbnMpO1xufTtcblxuY29uc3QgYnVpbGRTZW5kRGlhbW9uZHNDb25zZW5zdXNLVnMgPSAoXG4gIHBhcmFtczogVHlwZVdpdGhPcHRpb25hbEZlZXNBbmRFeHRyYURhdGE8U2VuZERpYW1vbmRzUmVxdWVzdD5cbikgPT4ge1xuICBjb25zdCBjb25zZW5zdXNFeHRyYURhdGFLVnM6IFRyYW5zYWN0aW9uRXh0cmFEYXRhS1ZbXSA9IFtdO1xuICBjb25zdCBkaWFtb25kTGV2ZWxLViA9IG5ldyBUcmFuc2FjdGlvbkV4dHJhRGF0YUtWKCk7XG4gIGRpYW1vbmRMZXZlbEtWLmtleSA9IGVuY29kZVVURjhUb0J5dGVzKCdEaWFtb25kTGV2ZWwnKTtcbiAgZGlhbW9uZExldmVsS1YudmFsdWUgPSB1dmFyaW50NjRUb0J1ZihwYXJhbXMuRGlhbW9uZExldmVsKTtcbiAgY29uc2Vuc3VzRXh0cmFEYXRhS1ZzLnB1c2goZGlhbW9uZExldmVsS1YpO1xuICBjb25zdCBkaWFtb25kUG9zdEhhc2hLViA9IG5ldyBUcmFuc2FjdGlvbkV4dHJhRGF0YUtWKCk7XG4gIGRpYW1vbmRQb3N0SGFzaEtWLmtleSA9IGVuY29kZVVURjhUb0J5dGVzKCdEaWFtb25kUG9zdEhhc2gnKTtcbiAgZGlhbW9uZFBvc3RIYXNoS1YudmFsdWUgPSBoZXhUb0J5dGVzKHBhcmFtcy5EaWFtb25kUG9zdEhhc2hIZXgpO1xuXG4gIGNvbnNlbnN1c0V4dHJhRGF0YUtWcy5wdXNoKGRpYW1vbmRQb3N0SGFzaEtWKTtcblxuICByZXR1cm4gY29uc2Vuc3VzRXh0cmFEYXRhS1ZzO1xufTtcblxuLy8gVGhpcyBvbmUgaXMgYSBiaXQgYW5ub3lpbmcgc2luY2Ugd2Ugc2hvdWxkIHJlYWxseSBsb29rIHVwIGhvdyBtYW55IGRpYW1vbmRzIHlvdSd2ZSBhbHJlYWR5IGdpdmVuIG9uIHRoaXMgcG9zdCBhbmQgb25seSBzZW5kIHRoZSBkaWZmLlxuZXhwb3J0IGNvbnN0IGNvbnN0cnVjdERpYW1vbmRUcmFuc2FjdGlvbiA9IChcbiAgcGFyYW1zOiBUeXBlV2l0aE9wdGlvbmFsRmVlc0FuZEV4dHJhRGF0YTxTZW5kRGlhbW9uZHNSZXF1ZXN0PlxuKTogUHJvbWlzZTxDb25zdHJ1Y3RlZFRyYW5zYWN0aW9uUmVzcG9uc2U+ID0+IHtcbiAgcmV0dXJuIFByb21pc2UucmVqZWN0KCdMb2NhbCBjb25zdHJ1Y3Rpb24gZm9yIGRpYW1vbmRzIG5vdCBzdXBwb3J0ZWQgeWV0LicpO1xufTtcblxuLyoqXG4gKiBodHRwczovL2RvY3MuZGVzby5vcmcvZGVzby1iYWNrZW5kL2NvbnN0cnVjdC10cmFuc2FjdGlvbnMvc29jaWFsLXRyYW5zYWN0aW9ucy1hcGkjbGlrZVxuICovXG5cbmV4cG9ydCB0eXBlIENyZWF0ZUxpa2VUcmFuc2FjdGlvblBhcmFtcyA9IFR5cGVXaXRoT3B0aW9uYWxGZWVzQW5kRXh0cmFEYXRhPFxuICBQYXJ0aWFsV2l0aFJlcXVpcmVkRmllbGRzPFxuICAgIENyZWF0ZUxpa2VTdGF0ZWxlc3NSZXF1ZXN0LFxuICAgICdMaWtlZFBvc3RIYXNoSGV4JyB8ICdSZWFkZXJQdWJsaWNLZXlCYXNlNThDaGVjaydcbiAgPlxuPjtcbmV4cG9ydCBjb25zdCB1cGRhdGVMaWtlU3RhdHVzID0gYXN5bmMgKFxuICBwYXJhbXM6IENyZWF0ZUxpa2VUcmFuc2FjdGlvblBhcmFtcyxcbiAgb3B0aW9ucz86IFR4UmVxdWVzdE9wdGlvbnNcbik6IFByb21pc2U8Q29uc3RydWN0ZWRBbmRTdWJtaXR0ZWRUeDxDcmVhdGVMaWtlU3RhdGVsZXNzUmVzcG9uc2U+PiA9PiB7XG4gIGNvbnN0IHR4V2l0aEZlZSA9IGdldFR4V2l0aEZlZU5hbm9zKFxuICAgIHBhcmFtcy5SZWFkZXJQdWJsaWNLZXlCYXNlNThDaGVjayxcbiAgICBidWlsZExpa2VNZXRhZGF0YShwYXJhbXMpLFxuICAgIHtcbiAgICAgIEV4dHJhRGF0YTogcGFyYW1zLkV4dHJhRGF0YSxcbiAgICAgIE1pbkZlZVJhdGVOYW5vc1BlcktCOiBwYXJhbXMuTWluRmVlUmF0ZU5hbm9zUGVyS0IsXG4gICAgICBUcmFuc2FjdGlvbkZlZXM6IHBhcmFtcy5UcmFuc2FjdGlvbkZlZXMsXG4gICAgfVxuICApO1xuXG4gIGlmIChvcHRpb25zPy5jaGVja1Blcm1pc3Npb25zICE9PSBmYWxzZSkge1xuICAgIGF3YWl0IGd1YXJkVHhQZXJtaXNzaW9uKHtcbiAgICAgIEdsb2JhbERFU09MaW1pdDpcbiAgICAgICAgdHhXaXRoRmVlLmZlZU5hbm9zICsgc3VtVHJhbnNhY3Rpb25GZWVzKHBhcmFtcy5UcmFuc2FjdGlvbkZlZXMpLFxuICAgICAgVHJhbnNhY3Rpb25Db3VudExpbWl0TWFwOiB7XG4gICAgICAgIExJS0U6XG4gICAgICAgICAgb3B0aW9ucz8udHhMaW1pdENvdW50ID8/XG4gICAgICAgICAgaWRlbnRpdHkudHJhbnNhY3Rpb25TcGVuZGluZ0xpbWl0T3B0aW9ucy5UcmFuc2FjdGlvbkNvdW50TGltaXRNYXBcbiAgICAgICAgICAgID8uTElLRSA/P1xuICAgICAgICAgIDEsXG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgcmV0dXJuIGhhbmRsZVNpZ25BbmRTdWJtaXQoJ2FwaS92MC9jcmVhdGUtbGlrZS1zdGF0ZWxlc3MnLCBwYXJhbXMsIHtcbiAgICAuLi5vcHRpb25zLFxuICAgIGNvbnN0cnVjdGlvbkZ1bmN0aW9uOiBjb25zdHJ1Y3RMaWtlVHJhbnNhY3Rpb24sXG4gIH0pO1xufTtcblxuY29uc3QgYnVpbGRMaWtlTWV0YWRhdGEgPSAocGFyYW1zOiBDcmVhdGVMaWtlVHJhbnNhY3Rpb25QYXJhbXMpID0+IHtcbiAgY29uc3QgbWV0YWRhdGEgPSBuZXcgVHJhbnNhY3Rpb25NZXRhZGF0YUxpa2UoKTtcbiAgbWV0YWRhdGEubGlrZWRQb3N0SGFzaCA9IGhleFRvQnl0ZXMocGFyYW1zLkxpa2VkUG9zdEhhc2hIZXgpO1xuICBtZXRhZGF0YS5pc1VubGlrZSA9ICEhcGFyYW1zLklzVW5saWtlO1xuICByZXR1cm4gbWV0YWRhdGE7XG59O1xuXG5leHBvcnQgY29uc3QgY29uc3RydWN0TGlrZVRyYW5zYWN0aW9uID0gKFxuICBwYXJhbXM6IENyZWF0ZUxpa2VUcmFuc2FjdGlvblBhcmFtc1xuKTogUHJvbWlzZTxDb25zdHJ1Y3RlZFRyYW5zYWN0aW9uUmVzcG9uc2U+ID0+IHtcbiAgcmV0dXJuIGNvbnN0cnVjdEJhbGFuY2VNb2RlbFR4KFxuICAgIHBhcmFtcy5SZWFkZXJQdWJsaWNLZXlCYXNlNThDaGVjayxcbiAgICBidWlsZExpa2VNZXRhZGF0YShwYXJhbXMpLFxuICAgIHtcbiAgICAgIEV4dHJhRGF0YTogcGFyYW1zLkV4dHJhRGF0YSxcbiAgICAgIE1pbkZlZVJhdGVOYW5vc1BlcktCOiBwYXJhbXMuTWluRmVlUmF0ZU5hbm9zUGVyS0IsXG4gICAgICBUcmFuc2FjdGlvbkZlZXM6IHBhcmFtcy5UcmFuc2FjdGlvbkZlZXMsXG4gICAgfVxuICApO1xufTtcblxuZW51bSBOZXdNZXNzYWdlVHlwZSB7XG4gIERNID0gMCxcbiAgR3JvdXAgPSAxLFxufVxuXG5lbnVtIE5ld01lc3NhZ2VPcGVyYXRpb24ge1xuICBDcmVhdGUgPSAwLFxuICBVcGRhdGUgPSAxLFxufVxuXG5pbnRlcmZhY2UgTmV3TWVzc2FnZVR4T3B0aW9ucyB7XG4gIHR5cGU6IE5ld01lc3NhZ2VUeXBlO1xuICBvcGVyYXRpb246IE5ld01lc3NhZ2VPcGVyYXRpb247XG4gIHRpbWVzdGFtcE5hbm9zPzogbnVtYmVyO1xufVxuXG4vKipcbiAqIGh0dHBzOi8vZG9jcy5kZXNvLm9yZy9kZXNvLWJhY2tlbmQvY29uc3RydWN0LXRyYW5zYWN0aW9ucy9zb2NpYWwtdHJhbnNhY3Rpb25zLWFwaSNzZW5kLWRpcmVjdC1tZXNzYWdlXG4gKiBUT0RPOiBmb3IgRE0gc2hvdWxkIHdlIGZpbGwgaW4gdGhlIG1lc3NhZ2luZyBncm91cCBuYW1lIGFzIGEgY29udmVuaWVuY2U/IEZvciBETSBpdCBpcyBjdXJyZW50bHkgYWx3YXlzICdkZWZhdWx0LWtleSdcbiAqL1xudHlwZSBTZW5kTmV3TWVzc2FnZVBhcmFtcyA9IFR5cGVXaXRoT3B0aW9uYWxGZWVzQW5kRXh0cmFEYXRhPFxuICBPbWl0PFNlbmROZXdNZXNzYWdlUmVxdWVzdCwgJ1RpbWVzdGFtcE5hbm9zU3RyaW5nJz5cbj47XG5leHBvcnQgY29uc3Qgc2VuZERNTWVzc2FnZSA9IGFzeW5jIChcbiAgcGFyYW1zOiBTZW5kTmV3TWVzc2FnZVBhcmFtcyxcbiAgb3B0aW9ucz86IFR4UmVxdWVzdE9wdGlvbnNcbik6IFByb21pc2U8XG4gIENvbnN0cnVjdGVkQW5kU3VibWl0dGVkVHg8XG4gICAgU2VuZE5ld01lc3NhZ2VSZXNwb25zZSB8IENvbnN0cnVjdGVkVHJhbnNhY3Rpb25SZXNwb25zZVxuICA+XG4+ID0+IHtcbiAgY29uc3QgdHhXaXRoRmVlID0gZ2V0VHhXaXRoRmVlTmFub3MoXG4gICAgcGFyYW1zLlNlbmRlckFjY2Vzc0dyb3VwT3duZXJQdWJsaWNLZXlCYXNlNThDaGVjayxcbiAgICBidWlsZE5ld01lc3NhZ2VNZXRhZGF0YShwYXJhbXMsIHtcbiAgICAgIHR5cGU6IE5ld01lc3NhZ2VUeXBlLkRNLFxuICAgICAgb3BlcmF0aW9uOiBOZXdNZXNzYWdlT3BlcmF0aW9uLkNyZWF0ZSxcbiAgICB9KSxcbiAgICB7XG4gICAgICBFeHRyYURhdGE6IHBhcmFtcy5FeHRyYURhdGEsXG4gICAgICBNaW5GZWVSYXRlTmFub3NQZXJLQjogcGFyYW1zLk1pbkZlZVJhdGVOYW5vc1BlcktCLFxuICAgICAgVHJhbnNhY3Rpb25GZWVzOiBwYXJhbXMuVHJhbnNhY3Rpb25GZWVzLFxuICAgIH1cbiAgKTtcblxuICBpZiAob3B0aW9ucz8uY2hlY2tQZXJtaXNzaW9ucyAhPT0gZmFsc2UpIHtcbiAgICBhd2FpdCBndWFyZFR4UGVybWlzc2lvbih7XG4gICAgICBHbG9iYWxERVNPTGltaXQ6XG4gICAgICAgIHR4V2l0aEZlZS5mZWVOYW5vcyArIHN1bVRyYW5zYWN0aW9uRmVlcyhwYXJhbXMuVHJhbnNhY3Rpb25GZWVzKSxcbiAgICAgIFRyYW5zYWN0aW9uQ291bnRMaW1pdE1hcDoge1xuICAgICAgICBORVdfTUVTU0FHRTpcbiAgICAgICAgICBvcHRpb25zPy50eExpbWl0Q291bnQgPz9cbiAgICAgICAgICBpZGVudGl0eS50cmFuc2FjdGlvblNwZW5kaW5nTGltaXRPcHRpb25zPy5UcmFuc2FjdGlvbkNvdW50TGltaXRNYXBcbiAgICAgICAgICAgID8uTkVXX01FU1NBR0UgPz9cbiAgICAgICAgICAxLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIHJldHVybiBoYW5kbGVTaWduQW5kU3VibWl0KCdhcGkvdjAvc2VuZC1kbS1tZXNzYWdlJywgcGFyYW1zLCB7XG4gICAgLi4ub3B0aW9ucyxcbiAgICBjb25zdHJ1Y3Rpb25GdW5jdGlvbjogY29uc3RydWN0U2VuZERNVHJhbnNhY3Rpb24sXG4gIH0pO1xufTtcblxuY29uc3QgYnVpbGROZXdNZXNzYWdlTWV0YWRhdGEgPSAoXG4gIHBhcmFtczogU2VuZE5ld01lc3NhZ2VQYXJhbXMsXG4gIHtcbiAgICB0eXBlLFxuICAgIG9wZXJhdGlvbixcbiAgICB0aW1lc3RhbXBOYW5vcyA9IE1hdGguY2VpbChcbiAgICAgIDFlNiAqIChnbG9iYWxUaGlzLnBlcmZvcm1hbmNlLnRpbWVPcmlnaW4gKyBnbG9iYWxUaGlzLnBlcmZvcm1hbmNlLm5vdygpKVxuICAgICksXG4gIH06IE5ld01lc3NhZ2VUeE9wdGlvbnNcbikgPT4ge1xuICBjb25zdCBtZXRhZGF0YSA9IG5ldyBUcmFuc2FjdGlvbk1ldGFkYXRhTmV3TWVzc2FnZSgpO1xuICBtZXRhZGF0YS5lbmNyeXB0ZWRUZXh0ID0gZW5jb2RlVVRGOFRvQnl0ZXMocGFyYW1zLkVuY3J5cHRlZE1lc3NhZ2VUZXh0KTtcbiAgbWV0YWRhdGEubmV3TWVzc2FnZU9wZXJhdGlvbiA9IG9wZXJhdGlvbjtcbiAgbWV0YWRhdGEubmV3TWVzc2FnZVR5cGUgPSB0eXBlO1xuICBtZXRhZGF0YS5yZWNpcGllbnRBY2Nlc3NHcm91cEtleW5hbWUgPSBlbmNvZGVVVEY4VG9CeXRlcyhcbiAgICBwYXJhbXMuUmVjaXBpZW50QWNjZXNzR3JvdXBLZXlOYW1lXG4gICk7XG4gIG1ldGFkYXRhLnJlY2lwaWVudEFjY2Vzc0dyb3VwT3duZXJQdWJsaWNLZXkgPSBiczU4UHVibGljS2V5VG9Db21wcmVzc2VkQnl0ZXMoXG4gICAgcGFyYW1zLlJlY2lwaWVudEFjY2Vzc0dyb3VwT3duZXJQdWJsaWNLZXlCYXNlNThDaGVja1xuICApO1xuICBtZXRhZGF0YS5yZWNpcGllbnRBY2Nlc3NHcm91cFB1YmxpY0tleSA9IGJzNThQdWJsaWNLZXlUb0NvbXByZXNzZWRCeXRlcyhcbiAgICBwYXJhbXMuUmVjaXBpZW50QWNjZXNzR3JvdXBQdWJsaWNLZXlCYXNlNThDaGVja1xuICApO1xuICBtZXRhZGF0YS5zZW5kZXJBY2Nlc3NHcm91cEtleU5hbWUgPSBlbmNvZGVVVEY4VG9CeXRlcyhcbiAgICBwYXJhbXMuU2VuZGVyQWNjZXNzR3JvdXBLZXlOYW1lXG4gICk7XG4gIG1ldGFkYXRhLnNlbmRlckFjY2Vzc0dyb3VwT3duZXJQdWJsaWNLZXkgPSBiczU4UHVibGljS2V5VG9Db21wcmVzc2VkQnl0ZXMoXG4gICAgcGFyYW1zLlNlbmRlckFjY2Vzc0dyb3VwT3duZXJQdWJsaWNLZXlCYXNlNThDaGVja1xuICApO1xuICBtZXRhZGF0YS5zZW5kZXJBY2Nlc3NHcm91cFB1YmxpY0tleSA9IGJzNThQdWJsaWNLZXlUb0NvbXByZXNzZWRCeXRlcyhcbiAgICBwYXJhbXMuU2VuZGVyQWNjZXNzR3JvdXBQdWJsaWNLZXlCYXNlNThDaGVja1xuICApO1xuICBtZXRhZGF0YS50aW1lc3RhbXBOYW5vcyA9IHRpbWVzdGFtcE5hbm9zO1xuXG4gIHJldHVybiBtZXRhZGF0YTtcbn07XG5cbmV4cG9ydCBjb25zdCBjb25zdHJ1Y3RTZW5kRE1UcmFuc2FjdGlvbiA9IChcbiAgcGFyYW1zOiBTZW5kTmV3TWVzc2FnZVBhcmFtc1xuKTogUHJvbWlzZTxDb25zdHJ1Y3RlZFRyYW5zYWN0aW9uUmVzcG9uc2U+ID0+IHtcbiAgcmV0dXJuIGNvbnN0cnVjdEJhbGFuY2VNb2RlbFR4KFxuICAgIHBhcmFtcy5TZW5kZXJBY2Nlc3NHcm91cE93bmVyUHVibGljS2V5QmFzZTU4Q2hlY2ssXG4gICAgYnVpbGROZXdNZXNzYWdlTWV0YWRhdGEocGFyYW1zLCB7XG4gICAgICB0eXBlOiBOZXdNZXNzYWdlVHlwZS5ETSxcbiAgICAgIG9wZXJhdGlvbjogTmV3TWVzc2FnZU9wZXJhdGlvbi5DcmVhdGUsXG4gICAgfSksXG4gICAge1xuICAgICAgRXh0cmFEYXRhOiBwYXJhbXMuRXh0cmFEYXRhLFxuICAgICAgTWluRmVlUmF0ZU5hbm9zUGVyS0I6IHBhcmFtcy5NaW5GZWVSYXRlTmFub3NQZXJLQixcbiAgICAgIFRyYW5zYWN0aW9uRmVlczogcGFyYW1zLlRyYW5zYWN0aW9uRmVlcyxcbiAgICB9XG4gICk7XG59O1xuXG4vKipcbiAqIGh0dHBzOi8vZG9jcy5kZXNvLm9yZy9kZXNvLWJhY2tlbmQvY29uc3RydWN0LXRyYW5zYWN0aW9ucy9zb2NpYWwtdHJhbnNhY3Rpb25zLWFwaSNzZW5kLWRpcmVjdC1tZXNzYWdlXG4gKi9cbmV4cG9ydCBjb25zdCB1cGRhdGVETU1lc3NhZ2UgPSBhc3luYyAoXG4gIHBhcmFtczogVHlwZVdpdGhPcHRpb25hbEZlZXNBbmRFeHRyYURhdGE8U2VuZE5ld01lc3NhZ2VSZXF1ZXN0PixcbiAgb3B0aW9ucz86IFR4UmVxdWVzdE9wdGlvbnNcbik6IFByb21pc2U8XG4gIENvbnN0cnVjdGVkQW5kU3VibWl0dGVkVHg8XG4gICAgU2VuZE5ld01lc3NhZ2VSZXNwb25zZSB8IENvbnN0cnVjdGVkVHJhbnNhY3Rpb25SZXNwb25zZVxuICA+XG4+ID0+IHtcbiAgY29uc3QgdHhXaXRoRmVlID0gZ2V0VHhXaXRoRmVlTmFub3MoXG4gICAgcGFyYW1zLlNlbmRlckFjY2Vzc0dyb3VwT3duZXJQdWJsaWNLZXlCYXNlNThDaGVjayxcbiAgICBidWlsZE5ld01lc3NhZ2VNZXRhZGF0YShwYXJhbXMsIHtcbiAgICAgIHR5cGU6IE5ld01lc3NhZ2VUeXBlLkRNLFxuICAgICAgb3BlcmF0aW9uOiBOZXdNZXNzYWdlT3BlcmF0aW9uLlVwZGF0ZSxcbiAgICAgIHRpbWVzdGFtcE5hbm9zOiBwYXJzZUludChwYXJhbXMuVGltZXN0YW1wTmFub3NTdHJpbmcpLFxuICAgIH0pLFxuICAgIHtcbiAgICAgIEV4dHJhRGF0YTogcGFyYW1zLkV4dHJhRGF0YSxcbiAgICAgIE1pbkZlZVJhdGVOYW5vc1BlcktCOiBwYXJhbXMuTWluRmVlUmF0ZU5hbm9zUGVyS0IsXG4gICAgICBUcmFuc2FjdGlvbkZlZXM6IHBhcmFtcy5UcmFuc2FjdGlvbkZlZXMsXG4gICAgfVxuICApO1xuXG4gIGlmIChvcHRpb25zPy5jaGVja1Blcm1pc3Npb25zICE9PSBmYWxzZSkge1xuICAgIGF3YWl0IGd1YXJkVHhQZXJtaXNzaW9uKHtcbiAgICAgIEdsb2JhbERFU09MaW1pdDpcbiAgICAgICAgdHhXaXRoRmVlLmZlZU5hbm9zICsgc3VtVHJhbnNhY3Rpb25GZWVzKHBhcmFtcy5UcmFuc2FjdGlvbkZlZXMpLFxuICAgICAgVHJhbnNhY3Rpb25Db3VudExpbWl0TWFwOiB7XG4gICAgICAgIE5FV19NRVNTQUdFOlxuICAgICAgICAgIG9wdGlvbnM/LnR4TGltaXRDb3VudCA/P1xuICAgICAgICAgIGlkZW50aXR5LnRyYW5zYWN0aW9uU3BlbmRpbmdMaW1pdE9wdGlvbnM/LlRyYW5zYWN0aW9uQ291bnRMaW1pdE1hcFxuICAgICAgICAgICAgPy5ORVdfTUVTU0FHRSA/P1xuICAgICAgICAgIDEsXG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgcmV0dXJuIGhhbmRsZVNpZ25BbmRTdWJtaXQoJ2FwaS92MC91cGRhdGUtZG0tbWVzc2FnZScsIHBhcmFtcywge1xuICAgIC4uLm9wdGlvbnMsXG4gICAgY29uc3RydWN0aW9uRnVuY3Rpb246IGNvbnN0cnVjdFVwZGF0ZURNVHJhbnNhY3Rpb24sXG4gIH0pO1xufTtcblxuZXhwb3J0IGNvbnN0IGNvbnN0cnVjdFVwZGF0ZURNVHJhbnNhY3Rpb24gPSAoXG4gIHBhcmFtczogVHlwZVdpdGhPcHRpb25hbEZlZXNBbmRFeHRyYURhdGE8U2VuZE5ld01lc3NhZ2VSZXF1ZXN0PlxuKTogUHJvbWlzZTxDb25zdHJ1Y3RlZFRyYW5zYWN0aW9uUmVzcG9uc2U+ID0+IHtcbiAgcmV0dXJuIGNvbnN0cnVjdEJhbGFuY2VNb2RlbFR4KFxuICAgIHBhcmFtcy5TZW5kZXJBY2Nlc3NHcm91cE93bmVyUHVibGljS2V5QmFzZTU4Q2hlY2ssXG4gICAgYnVpbGROZXdNZXNzYWdlTWV0YWRhdGEocGFyYW1zLCB7XG4gICAgICB0eXBlOiBOZXdNZXNzYWdlVHlwZS5ETSxcbiAgICAgIG9wZXJhdGlvbjogTmV3TWVzc2FnZU9wZXJhdGlvbi5VcGRhdGUsXG4gICAgICB0aW1lc3RhbXBOYW5vczogcGFyc2VJbnQocGFyYW1zLlRpbWVzdGFtcE5hbm9zU3RyaW5nKSxcbiAgICB9KSxcbiAgICB7XG4gICAgICBFeHRyYURhdGE6IHBhcmFtcy5FeHRyYURhdGEsXG4gICAgICBNaW5GZWVSYXRlTmFub3NQZXJLQjogcGFyYW1zLk1pbkZlZVJhdGVOYW5vc1BlcktCLFxuICAgICAgVHJhbnNhY3Rpb25GZWVzOiBwYXJhbXMuVHJhbnNhY3Rpb25GZWVzLFxuICAgIH1cbiAgKTtcbn07XG5cbi8qKlxuICogaHR0cHM6Ly9kb2NzLmRlc28ub3JnL2Rlc28tYmFja2VuZC9jb25zdHJ1Y3QtdHJhbnNhY3Rpb25zL3NvY2lhbC10cmFuc2FjdGlvbnMtYXBpI3NlbmQtZ3JvdXAtY2hhdC1tZXNzYWdlXG4gKi9cbmV4cG9ydCBjb25zdCBzZW5kR3JvdXBDaGF0TWVzc2FnZSA9IGFzeW5jIChcbiAgcGFyYW1zOiBTZW5kTmV3TWVzc2FnZVBhcmFtcyxcbiAgb3B0aW9ucz86IFR4UmVxdWVzdE9wdGlvbnNcbik6IFByb21pc2U8XG4gIENvbnN0cnVjdGVkQW5kU3VibWl0dGVkVHg8XG4gICAgU2VuZE5ld01lc3NhZ2VSZXNwb25zZSB8IENvbnN0cnVjdGVkVHJhbnNhY3Rpb25SZXNwb25zZVxuICA+XG4+ID0+IHtcbiAgY29uc3QgdHhXaXRoRmVlID0gZ2V0VHhXaXRoRmVlTmFub3MoXG4gICAgcGFyYW1zLlNlbmRlckFjY2Vzc0dyb3VwT3duZXJQdWJsaWNLZXlCYXNlNThDaGVjayxcbiAgICBidWlsZE5ld01lc3NhZ2VNZXRhZGF0YShwYXJhbXMsIHtcbiAgICAgIHR5cGU6IE5ld01lc3NhZ2VUeXBlLkdyb3VwLFxuICAgICAgb3BlcmF0aW9uOiBOZXdNZXNzYWdlT3BlcmF0aW9uLkNyZWF0ZSxcbiAgICB9KSxcbiAgICB7XG4gICAgICBFeHRyYURhdGE6IHBhcmFtcy5FeHRyYURhdGEsXG4gICAgICBNaW5GZWVSYXRlTmFub3NQZXJLQjogcGFyYW1zLk1pbkZlZVJhdGVOYW5vc1BlcktCLFxuICAgICAgVHJhbnNhY3Rpb25GZWVzOiBwYXJhbXMuVHJhbnNhY3Rpb25GZWVzLFxuICAgIH1cbiAgKTtcblxuICBpZiAob3B0aW9ucz8uY2hlY2tQZXJtaXNzaW9ucyAhPT0gZmFsc2UpIHtcbiAgICBhd2FpdCBndWFyZFR4UGVybWlzc2lvbih7XG4gICAgICBHbG9iYWxERVNPTGltaXQ6XG4gICAgICAgIHR4V2l0aEZlZS5mZWVOYW5vcyArIHN1bVRyYW5zYWN0aW9uRmVlcyhwYXJhbXMuVHJhbnNhY3Rpb25GZWVzKSxcbiAgICAgIFRyYW5zYWN0aW9uQ291bnRMaW1pdE1hcDoge1xuICAgICAgICBORVdfTUVTU0FHRTpcbiAgICAgICAgICBvcHRpb25zPy50eExpbWl0Q291bnQgPz9cbiAgICAgICAgICBpZGVudGl0eS50cmFuc2FjdGlvblNwZW5kaW5nTGltaXRPcHRpb25zPy5UcmFuc2FjdGlvbkNvdW50TGltaXRNYXBcbiAgICAgICAgICAgID8uTkVXX01FU1NBR0UgPz9cbiAgICAgICAgICAxLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIHJldHVybiBoYW5kbGVTaWduQW5kU3VibWl0KCdhcGkvdjAvc2VuZC1ncm91cC1jaGF0LW1lc3NhZ2UnLCBwYXJhbXMsIHtcbiAgICAuLi5vcHRpb25zLFxuICAgIGNvbnN0cnVjdGlvbkZ1bmN0aW9uOiBjb25zdHJ1Y3RTZW5kR3JvdXBDaGF0TWVzc2FnZVRyYW5zYWN0aW9uLFxuICB9KTtcbn07XG5cbmV4cG9ydCBjb25zdCBjb25zdHJ1Y3RTZW5kR3JvdXBDaGF0TWVzc2FnZVRyYW5zYWN0aW9uID0gKFxuICBwYXJhbXM6IFNlbmROZXdNZXNzYWdlUGFyYW1zXG4pOiBQcm9taXNlPENvbnN0cnVjdGVkVHJhbnNhY3Rpb25SZXNwb25zZT4gPT4ge1xuICByZXR1cm4gY29uc3RydWN0QmFsYW5jZU1vZGVsVHgoXG4gICAgcGFyYW1zLlNlbmRlckFjY2Vzc0dyb3VwT3duZXJQdWJsaWNLZXlCYXNlNThDaGVjayxcbiAgICBidWlsZE5ld01lc3NhZ2VNZXRhZGF0YShwYXJhbXMsIHtcbiAgICAgIHR5cGU6IE5ld01lc3NhZ2VUeXBlLkdyb3VwLFxuICAgICAgb3BlcmF0aW9uOiBOZXdNZXNzYWdlT3BlcmF0aW9uLkNyZWF0ZSxcbiAgICB9KSxcbiAgICB7XG4gICAgICBFeHRyYURhdGE6IHBhcmFtcy5FeHRyYURhdGEsXG4gICAgICBNaW5GZWVSYXRlTmFub3NQZXJLQjogcGFyYW1zLk1pbkZlZVJhdGVOYW5vc1BlcktCLFxuICAgICAgVHJhbnNhY3Rpb25GZWVzOiBwYXJhbXMuVHJhbnNhY3Rpb25GZWVzLFxuICAgIH1cbiAgKTtcbn07XG5cbi8qKlxuICogQ29udmVuaWVuY2UgZnVuY3Rpb24gdG8gc2VuZCBhIG1lc3NhZ2UgdG8gYSBncm91cCBjaGF0IG9yIERNIHRoYXQgaGFuZGxlc1xuICogZW5jcnlwdGlvbiBhbmQgYWNjZXNzIGdyb3VwIHBhcnR5IGNoZWNrLiBBY2Nlc3NHcm91cCBpcyBvcHRpb25hbCwgYW5kIGlmIG5vdFxuICogcHJvdmlkZWQgd2UgbWFrZSB0aGUgYXNzdW1wdGlvbiB0aGF0IHRoaXMgaXMgYSBkaXJlY3QgbWVzc2FnZSBhbmQgdXNlIHRoZVxuICogdXNlcidzIGRlZmF1bHQgbWVzc2FnaW5nIGdyb3VwLiBZb3UgbWF5IGFsc28gcGFzcyBhbiBvcHRpb25hbFxuICogc2VuZE1lc3NhZ2VVbmVuY3J5cHRlZCBmbGFnIHRvIGZvcmNlIHRoZSBtZXNzYWdlIHRvIGJlIHNlbnQgdW5lbmNyeXB0ZWQuXG4gKi9cbmludGVyZmFjZSBTZW5kTWVzc2FnZVBhcmFtcyB7XG4gIFNlbmRlclB1YmxpY0tleUJhc2U1OENoZWNrOiBzdHJpbmc7XG4gIFJlY2lwaWVudFB1YmxpY0tleUJhc2U1OENoZWNrOiBzdHJpbmc7XG4gIE1lc3NhZ2U6IHN0cmluZztcbiAgQWNjZXNzR3JvdXA/OiBzdHJpbmc7XG4gIEV4dHJhRGF0YT86IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH07XG4gIE1pbkZlZVJhdGVOYW5vc1BlcktCPzogbnVtYmVyO1xuICBUcmFuc2FjdGlvbkZlZXM/OiBUcmFuc2FjdGlvbkZlZVtdO1xufVxuZXhwb3J0IGNvbnN0IHNlbmRNZXNzYWdlID0gYXN5bmMgKFxuICBwYXJhbXM6IFNlbmRNZXNzYWdlUGFyYW1zLFxuICBvcHRpb25zPzogVHhSZXF1ZXN0T3B0aW9ucyAmIHsgc2VuZE1lc3NhZ2VVbmVuY3J5cHRlZD86IGJvb2xlYW4gfVxuKSA9PiB7XG4gIGlmICghcGFyYW1zLkFjY2Vzc0dyb3VwKSB7XG4gICAgcGFyYW1zLkFjY2Vzc0dyb3VwID0gJ2RlZmF1bHQta2V5JztcbiAgfVxuXG4gIGNvbnN0IHR4V2l0aEZlZSA9IGdldFR4V2l0aEZlZU5hbm9zKFxuICAgIHBhcmFtcy5TZW5kZXJQdWJsaWNLZXlCYXNlNThDaGVjayxcbiAgICBidWlsZE5ld01lc3NhZ2VNZXRhZGF0YShcbiAgICAgIHtcbiAgICAgICAgLy8gTk9URTogc29tZSBvZiB0aGVzZSBmaWVsZHMgd2UgZG9uJ3QgKmFjdHVhbGx5KiBrbm93IHdpdGhvdXQgbWFraW5nIGFuXG4gICAgICAgIC8vIGFwaSBjYWxsIHRvIGdldCB0aGVtLCBidXQgZm9yIHRoZSBwdXJwb3NlIG9mIGVzdGltYXRpbmcgdGhlIGZlZXMsIHdlXG4gICAgICAgIC8vIGNhbiBqdXN0IHVzZSBkdW1teSB2YWx1ZXMuXG4gICAgICAgIFNlbmRlckFjY2Vzc0dyb3VwT3duZXJQdWJsaWNLZXlCYXNlNThDaGVjazpcbiAgICAgICAgICBwYXJhbXMuU2VuZGVyUHVibGljS2V5QmFzZTU4Q2hlY2ssXG4gICAgICAgIFNlbmRlckFjY2Vzc0dyb3VwUHVibGljS2V5QmFzZTU4Q2hlY2s6XG4gICAgICAgICAgcGFyYW1zLlNlbmRlclB1YmxpY0tleUJhc2U1OENoZWNrLFxuICAgICAgICBTZW5kZXJBY2Nlc3NHcm91cEtleU5hbWU6IHBhcmFtcy5BY2Nlc3NHcm91cCxcbiAgICAgICAgUmVjaXBpZW50QWNjZXNzR3JvdXBPd25lclB1YmxpY0tleUJhc2U1OENoZWNrOlxuICAgICAgICAgIHBhcmFtcy5SZWNpcGllbnRQdWJsaWNLZXlCYXNlNThDaGVjayxcbiAgICAgICAgUmVjaXBpZW50QWNjZXNzR3JvdXBQdWJsaWNLZXlCYXNlNThDaGVjazpcbiAgICAgICAgICBwYXJhbXMuUmVjaXBpZW50UHVibGljS2V5QmFzZTU4Q2hlY2ssXG4gICAgICAgIFJlY2lwaWVudEFjY2Vzc0dyb3VwS2V5TmFtZTogcGFyYW1zLkFjY2Vzc0dyb3VwLFxuICAgICAgICAvLyBOT1RFOiBXZSBhcmUgY2FsY3VsYXRpbmcgdGhlIGZlZSBpbiBvcmRlciB0byBkZXRlcm1pbmUgd2hldGhlciBvciBub3RcbiAgICAgICAgLy8gd2Ugc2hvdWxkIHByb21wdCB0aGUgdXNlciB0byByZS1hcHByb3ZlIHRoZSBkZXJpdmVkIGtleSB1c2VkIGZvclxuICAgICAgICAvLyBzaWduaW5nIHRyYW5zYWN0aW9ucy4gV2UgKm11c3QqIGRvIHRoaXMgYmVmb3JlIGV4ZWN1dGluZyBhbnkgYXN5bmNcbiAgICAgICAgLy8gY29kZSwgb3RoZXJ3aXNlIHBvcHVwIGJsb2NrZXJzIHdpbGwgZ2VuZXJhbGx5IGJsb2NrIHRoZSBwb3B1cC5cbiAgICAgICAgLy8gRW5jcnlwdGluZyB0aGUgbWVzc2FnZSBpcyBhbiBhc3luYyBvcGVyYXRpb24sIHNvIHdlIG11c3QgdXNlIHRoZVxuICAgICAgICAvLyBwbGFpbiB0ZXh0IG1lc3NhZ2UgZm9yIHRoZSBmZWUgY2FsY3VsYXRpb24gd2hpY2ggaXMgbm90IGV4YWN0bHlcbiAgICAgICAgLy8gcmlnaHQsIGJ1dCBpdCBzaG91bGQgYmUgY2xvc2UuIFdlIG1heSBuZWVkIHRvIHJldmlzaXQgdGhpcywgaG93ZXZlcixcbiAgICAgICAgLy8gYW5kIGluY2x1ZGUgYSBidWZmZXIgaW4gdGhlIGZlZSBjYWxjdWxhdGlvbi5cbiAgICAgICAgRW5jcnlwdGVkTWVzc2FnZVRleHQ6IHBhcmFtcy5NZXNzYWdlLFxuXG4gICAgICAgIE1pbkZlZVJhdGVOYW5vc1BlcktCOiBwYXJhbXMuTWluRmVlUmF0ZU5hbm9zUGVyS0IsXG4gICAgICAgIFRyYW5zYWN0aW9uRmVlczogcGFyYW1zLlRyYW5zYWN0aW9uRmVlcyxcbiAgICAgICAgRXh0cmFEYXRhOiBwYXJhbXMuRXh0cmFEYXRhLFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdHlwZTogTmV3TWVzc2FnZVR5cGUuR3JvdXAsXG4gICAgICAgIG9wZXJhdGlvbjogTmV3TWVzc2FnZU9wZXJhdGlvbi5DcmVhdGUsXG4gICAgICB9XG4gICAgKSxcbiAgICB7XG4gICAgICBFeHRyYURhdGE6IHBhcmFtcy5FeHRyYURhdGEsXG4gICAgICBNaW5GZWVSYXRlTmFub3NQZXJLQjogcGFyYW1zLk1pbkZlZVJhdGVOYW5vc1BlcktCLFxuICAgICAgVHJhbnNhY3Rpb25GZWVzOiBwYXJhbXMuVHJhbnNhY3Rpb25GZWVzLFxuICAgIH1cbiAgKTtcblxuICBpZiAob3B0aW9ucz8uY2hlY2tQZXJtaXNzaW9ucyAhPT0gZmFsc2UpIHtcbiAgICBhd2FpdCBndWFyZFR4UGVybWlzc2lvbih7XG4gICAgICBHbG9iYWxERVNPTGltaXQ6XG4gICAgICAgIHR4V2l0aEZlZS5mZWVOYW5vcyArIHN1bVRyYW5zYWN0aW9uRmVlcyhwYXJhbXMuVHJhbnNhY3Rpb25GZWVzKSxcbiAgICAgIFRyYW5zYWN0aW9uQ291bnRMaW1pdE1hcDoge1xuICAgICAgICBORVdfTUVTU0FHRTpcbiAgICAgICAgICBvcHRpb25zPy50eExpbWl0Q291bnQgPz9cbiAgICAgICAgICBpZGVudGl0eS50cmFuc2FjdGlvblNwZW5kaW5nTGltaXRPcHRpb25zPy5UcmFuc2FjdGlvbkNvdW50TGltaXRNYXBcbiAgICAgICAgICAgID8uTkVXX01FU1NBR0UgPz9cbiAgICAgICAgICAxLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIGNvbnN0IHtcbiAgICBTZW5kZXJBY2Nlc3NHcm91cFB1YmxpY0tleUJhc2U1OENoZWNrLFxuICAgIFNlbmRlckFjY2Vzc0dyb3VwS2V5TmFtZSxcbiAgICBSZWNpcGllbnRBY2Nlc3NHcm91cFB1YmxpY0tleUJhc2U1OENoZWNrLFxuICAgIFJlY2lwaWVudEFjY2Vzc0dyb3VwS2V5TmFtZSxcbiAgfSA9IGF3YWl0IGNoZWNrUGFydHlBY2Nlc3NHcm91cHMoe1xuICAgIFNlbmRlclB1YmxpY0tleUJhc2U1OENoZWNrOiBwYXJhbXMuU2VuZGVyUHVibGljS2V5QmFzZTU4Q2hlY2ssXG4gICAgU2VuZGVyQWNjZXNzR3JvdXBLZXlOYW1lOiAnZGVmYXVsdC1rZXknLFxuICAgIFJlY2lwaWVudFB1YmxpY0tleUJhc2U1OENoZWNrOiBwYXJhbXMuUmVjaXBpZW50UHVibGljS2V5QmFzZTU4Q2hlY2ssXG4gICAgUmVjaXBpZW50QWNjZXNzR3JvdXBLZXlOYW1lOiBwYXJhbXMuQWNjZXNzR3JvdXAsXG4gIH0pO1xuXG4gIGlmICghU2VuZGVyQWNjZXNzR3JvdXBLZXlOYW1lKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdTZW5kZXIgZG9lcyBub3QgaGF2ZSBkZWZhdWx0IG1lc3NhZ2luZyBncm91cCcpO1xuICB9XG5cbiAgY29uc3QgRW5jcnlwdGVkTWVzc2FnZVRleHQgPSBvcHRpb25zPy5zZW5kTWVzc2FnZVVuZW5jcnlwdGVkXG4gICAgPyBoZXhFbmNvZGVQbGFpblRleHQocGFyYW1zLk1lc3NhZ2UpXG4gICAgOiBhd2FpdCBpZGVudGl0eS5lbmNyeXB0TWVzc2FnZShcbiAgICAgICAgUmVjaXBpZW50QWNjZXNzR3JvdXBQdWJsaWNLZXlCYXNlNThDaGVjayxcbiAgICAgICAgcGFyYW1zLk1lc3NhZ2VcbiAgICAgICk7XG5cbiAgaWYgKCFFbmNyeXB0ZWRNZXNzYWdlVGV4dCkge1xuICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIGVuY3J5cHQgbWVzc2FnZScpO1xuICB9XG5cbiAgY29uc3Qgc2VuZE1lc3NhZ2VSZXF1ZXN0UGFyYW1zID0ge1xuICAgIFNlbmRlckFjY2Vzc0dyb3VwT3duZXJQdWJsaWNLZXlCYXNlNThDaGVjazpcbiAgICAgIHBhcmFtcy5TZW5kZXJQdWJsaWNLZXlCYXNlNThDaGVjayxcbiAgICBTZW5kZXJBY2Nlc3NHcm91cFB1YmxpY0tleUJhc2U1OENoZWNrLFxuICAgIFNlbmRlckFjY2Vzc0dyb3VwS2V5TmFtZSxcbiAgICBSZWNpcGllbnRBY2Nlc3NHcm91cE93bmVyUHVibGljS2V5QmFzZTU4Q2hlY2s6XG4gICAgICBwYXJhbXMuUmVjaXBpZW50UHVibGljS2V5QmFzZTU4Q2hlY2ssXG4gICAgUmVjaXBpZW50QWNjZXNzR3JvdXBQdWJsaWNLZXlCYXNlNThDaGVjayxcbiAgICBSZWNpcGllbnRBY2Nlc3NHcm91cEtleU5hbWUsXG4gICAgRW5jcnlwdGVkTWVzc2FnZVRleHQsXG4gICAgRXh0cmFEYXRhOiBwYXJhbXMuRXh0cmFEYXRhLFxuICAgIE1pbkZlZVJhdGVOYW5vc1BlcktCOiBwYXJhbXMuTWluRmVlUmF0ZU5hbm9zUGVyS0IsXG4gIH07XG5cbiAgcmV0dXJuIHBhcmFtcy5BY2Nlc3NHcm91cCA9PT0gJ2RlZmF1bHQta2V5J1xuICAgID8gc2VuZERNTWVzc2FnZShzZW5kTWVzc2FnZVJlcXVlc3RQYXJhbXMsIG9wdGlvbnMpXG4gICAgOiBzZW5kR3JvdXBDaGF0TWVzc2FnZShzZW5kTWVzc2FnZVJlcXVlc3RQYXJhbXMsIG9wdGlvbnMpO1xufTtcblxuLyoqXG4gKiBodHRwczovL2RvY3MuZGVzby5vcmcvZGVzby1iYWNrZW5kL2NvbnN0cnVjdC10cmFuc2FjdGlvbnMvc29jaWFsLXRyYW5zYWN0aW9ucy1hcGkjc2VuZC1ncm91cC1jaGF0LW1lc3NhZ2VcbiAqL1xuZXhwb3J0IGNvbnN0IHVwZGF0ZUdyb3VwQ2hhdE1lc3NhZ2UgPSBhc3luYyAoXG4gIHBhcmFtczogVHlwZVdpdGhPcHRpb25hbEZlZXNBbmRFeHRyYURhdGE8U2VuZE5ld01lc3NhZ2VSZXF1ZXN0PixcbiAgb3B0aW9ucz86IFR4UmVxdWVzdE9wdGlvbnNcbik6IFByb21pc2U8XG4gIENvbnN0cnVjdGVkQW5kU3VibWl0dGVkVHg8XG4gICAgU2VuZE5ld01lc3NhZ2VSZXNwb25zZSB8IENvbnN0cnVjdGVkVHJhbnNhY3Rpb25SZXNwb25zZVxuICA+XG4+ID0+IHtcbiAgY29uc3QgdHhXaXRoRmVlID0gZ2V0VHhXaXRoRmVlTmFub3MoXG4gICAgcGFyYW1zLlNlbmRlckFjY2Vzc0dyb3VwT3duZXJQdWJsaWNLZXlCYXNlNThDaGVjayxcbiAgICBidWlsZE5ld01lc3NhZ2VNZXRhZGF0YShwYXJhbXMsIHtcbiAgICAgIHR5cGU6IE5ld01lc3NhZ2VUeXBlLkdyb3VwLFxuICAgICAgb3BlcmF0aW9uOiBOZXdNZXNzYWdlT3BlcmF0aW9uLlVwZGF0ZSxcbiAgICAgIHRpbWVzdGFtcE5hbm9zOiBwYXJzZUludChwYXJhbXMuVGltZXN0YW1wTmFub3NTdHJpbmcpLFxuICAgIH0pLFxuICAgIHtcbiAgICAgIEV4dHJhRGF0YTogcGFyYW1zLkV4dHJhRGF0YSxcbiAgICAgIE1pbkZlZVJhdGVOYW5vc1BlcktCOiBwYXJhbXMuTWluRmVlUmF0ZU5hbm9zUGVyS0IsXG4gICAgICBUcmFuc2FjdGlvbkZlZXM6IHBhcmFtcy5UcmFuc2FjdGlvbkZlZXMsXG4gICAgfVxuICApO1xuXG4gIGlmIChvcHRpb25zPy5jaGVja1Blcm1pc3Npb25zICE9PSBmYWxzZSkge1xuICAgIGF3YWl0IGd1YXJkVHhQZXJtaXNzaW9uKHtcbiAgICAgIEdsb2JhbERFU09MaW1pdDpcbiAgICAgICAgdHhXaXRoRmVlLmZlZU5hbm9zICsgc3VtVHJhbnNhY3Rpb25GZWVzKHBhcmFtcy5UcmFuc2FjdGlvbkZlZXMpLFxuICAgICAgVHJhbnNhY3Rpb25Db3VudExpbWl0TWFwOiB7XG4gICAgICAgIE5FV19NRVNTQUdFOlxuICAgICAgICAgIG9wdGlvbnM/LnR4TGltaXRDb3VudCA/P1xuICAgICAgICAgIGlkZW50aXR5LnRyYW5zYWN0aW9uU3BlbmRpbmdMaW1pdE9wdGlvbnM/LlRyYW5zYWN0aW9uQ291bnRMaW1pdE1hcFxuICAgICAgICAgICAgPy5ORVdfTUVTU0FHRSA/P1xuICAgICAgICAgIDEsXG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgcmV0dXJuIGhhbmRsZVNpZ25BbmRTdWJtaXQoJ2FwaS92MC91cGRhdGUtZ3JvdXAtY2hhdC1tZXNzYWdlJywgcGFyYW1zLCB7XG4gICAgLi4ub3B0aW9ucyxcbiAgICBjb25zdHJ1Y3Rpb25GdW5jdGlvbjogY29uc3RydWN0VXBkYXRlR3JvdXBDaGF0TWVzc2FnZVRyYW5zYWN0aW9uLFxuICB9KTtcbn07XG5cbmV4cG9ydCBjb25zdCBjb25zdHJ1Y3RVcGRhdGVHcm91cENoYXRNZXNzYWdlVHJhbnNhY3Rpb24gPSAoXG4gIHBhcmFtczogVHlwZVdpdGhPcHRpb25hbEZlZXNBbmRFeHRyYURhdGE8U2VuZE5ld01lc3NhZ2VSZXF1ZXN0PlxuKTogUHJvbWlzZTxDb25zdHJ1Y3RlZFRyYW5zYWN0aW9uUmVzcG9uc2U+ID0+IHtcbiAgcmV0dXJuIGNvbnN0cnVjdEJhbGFuY2VNb2RlbFR4KFxuICAgIHBhcmFtcy5TZW5kZXJBY2Nlc3NHcm91cE93bmVyUHVibGljS2V5QmFzZTU4Q2hlY2ssXG5cbiAgICBidWlsZE5ld01lc3NhZ2VNZXRhZGF0YShwYXJhbXMsIHtcbiAgICAgIHR5cGU6IE5ld01lc3NhZ2VUeXBlLkdyb3VwLFxuICAgICAgb3BlcmF0aW9uOiBOZXdNZXNzYWdlT3BlcmF0aW9uLlVwZGF0ZSxcbiAgICAgIHRpbWVzdGFtcE5hbm9zOiBwYXJzZUludChwYXJhbXMuVGltZXN0YW1wTmFub3NTdHJpbmcpLFxuICAgIH0pLFxuICAgIHtcbiAgICAgIEV4dHJhRGF0YTogcGFyYW1zLkV4dHJhRGF0YSxcbiAgICAgIE1pbkZlZVJhdGVOYW5vc1BlcktCOiBwYXJhbXMuTWluRmVlUmF0ZU5hbm9zUGVyS0IsXG4gICAgICBUcmFuc2FjdGlvbkZlZXM6IHBhcmFtcy5UcmFuc2FjdGlvbkZlZXMsXG4gICAgfVxuICApO1xufTtcblxuLyoqXG4gKiBAcHJpdmF0ZVxuICogaW50ZXJuYWwgaGVscGVyIGZ1bmN0aW9uIHRvIGNvbnZlcnQgYSBzdHJpbmcgdG8gaGV4XG4gKiBAcGFyYW0gcGxhaW5UZXh0XG4gKiBAcmV0dXJucyBoZXggZW5jb2RlZCBzdHJpbmdcbiAqL1xuZnVuY3Rpb24gaGV4RW5jb2RlUGxhaW5UZXh0KHBsYWluVGV4dDogc3RyaW5nKSB7XG4gIGNvbnN0IHRleHRFbmNvZGVyID0gbmV3IFRleHRFbmNvZGVyKCk7XG4gIGNvbnN0IGJ5dGVzID0gdGV4dEVuY29kZXIuZW5jb2RlKHBsYWluVGV4dCk7XG4gIHJldHVybiBlY1V0aWxzLmJ5dGVzVG9IZXgobmV3IFVpbnQ4QXJyYXkoYnl0ZXMpKTtcbn1cbiJdfQ==